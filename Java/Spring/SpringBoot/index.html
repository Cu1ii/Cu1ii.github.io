<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>SpringBoot | Cu1universe</title><meta name="keywords" content="SpringBoot, java"><meta name="author" content="Cu1"><meta name="copyright" content="Cu1"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="SpringBoot1、创建 SpringBoot 项目1.1、利用官网创建 进入 SpringBoot 官网 SpringBoot   划到 Quickstart Your Project   点击  Spring Initializr  如下图   在 Dependencies 处添加项目依赖 最后点击 GENERATE 会自动下载压缩包, 包中即为创建好的 SpringBoot i项目">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBoot">
<meta property="og:url" content="https://cu1universe.cn/Java/Spring/SpringBoot/index.html">
<meta property="og:site_name" content="Cu1universe">
<meta property="og:description" content="SpringBoot1、创建 SpringBoot 项目1.1、利用官网创建 进入 SpringBoot 官网 SpringBoot   划到 Quickstart Your Project   点击  Spring Initializr  如下图   在 Dependencies 处添加项目依赖 最后点击 GENERATE 会自动下载压缩包, 包中即为创建好的 SpringBoot i项目">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s4.ax1x.com/2022/02/14/H6o0n1.jpg">
<meta property="article:published_time" content="2022-05-16T16:00:00.000Z">
<meta property="article:modified_time" content="2022-05-17T13:00:06.005Z">
<meta property="article:author" content="Cu1">
<meta property="article:tag" content="SpringBoot, java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s4.ax1x.com/2022/02/14/H6o0n1.jpg"><link rel="shortcut icon" href="https://s4.ax1x.com/2022/02/25/bEauvT.jpg"><link rel="canonical" href="https://cu1universe.cn/Java/Spring/SpringBoot/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SpringBoot',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-05-17 21:00:06'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/zyoushuo/Blog@latest/hexo/css/loading_style_2.css" ><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/zyoushuo/Blog@latest/hexo/css/loading_style_1.css" ><link rel="stylesheet" href="/css/custom.css"  media="defer" onload="this.media='all'"><link rel="stylesheet" href="//at.alicdn.com/t/font_3206210_f2vpakpfd7l.css"  media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Cu1ii/BlogDebris@main/CDN/CSS/css.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-clock/lib/clock.min.css" /><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s4.ax1x.com/2022/02/14/H6o0n1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">29</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">16</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Cu1universe</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SpringBoot</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-05-16T16:00:00.000Z" title="发表于 2022-05-17 00:00:00">2022-05-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-05-17T13:00:06.005Z" title="更新于 2022-05-17 21:00:06">2022-05-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/">Java</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/Spring/">Spring</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">21.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>87分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SpringBoot"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/Java/Spring/SpringBoot/#post-comment"><span id="twikoo-count"></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h1><h2 id="1、创建-SpringBoot-项目"><a href="#1、创建-SpringBoot-项目" class="headerlink" title="1、创建 SpringBoot 项目"></a>1、创建 SpringBoot 项目</h2><h3 id="1-1、利用官网创建"><a href="#1-1、利用官网创建" class="headerlink" title="1.1、利用官网创建"></a>1.1、利用官网创建</h3><ol>
<li><p>进入 <code>SpringBoot</code> 官网 <a target="_blank" rel="noopener" href="https://spring.io/projects/spring-boot#overview">SpringBoot</a> </p>
</li>
<li><p>划到 <code>Quickstart Your Project</code> </p>
</li>
<li><p>点击  <a target="_blank" rel="noopener" href="https://start.spring.io/">Spring Initializr</a></p>
</li>
<li><p>如下图</p>
<img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="C:\Users\雷神\AppData\Roaming\Typora\typora-user-images\image-20211020171219051.png" alt="image-20211020171219051" style="zoom:80%;" />

<p>在 <code>Dependencies</code> 处添加项目依赖 最后点击 <code>GENERATE</code> 会自动下载压缩包, 包中即为创建好的 <code>SpringBoot</code> i项目</p>
</li>
</ol>
<h3 id="1-2、利用-IDEA-创建"><a href="#1-2、利用-IDEA-创建" class="headerlink" title="1.2、利用 IDEA 创建"></a>1.2、利用 IDEA 创建</h3><p>一般开发都是在 IDEA 中创建</p>
<h3 id="1-3、项目结构"><a href="#1-3、项目结构" class="headerlink" title="1.3、项目结构"></a>1.3、项目结构</h3><p>略</p>
<p><strong>pom.xml 中的一些信息</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--所有的 SpringBoot 依赖都是使用 spring-boot-starter 开头--&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- web 依赖: 自动集成了 Tomcat, dispatcherServlet--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!--单元测试--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--打 jar 包插件--&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>更改端口号:</strong></p>
<p>在 <code>application.propertise</code> 中</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更改项目端口号</span></span><br><span class="line"><span class="meta">server.port</span>=<span class="string">8081</span></span><br></pre></td></tr></table></figure>



<p><strong>更改启动页面</strong></p>
<ul>
<li>在 <code>resource</code> 下新建 <code>banner.txt</code> 在里面导入自己想要的图案即可</li>
</ul>
<h2 id="2、SpringBoot-原理初步"><a href="#2、SpringBoot-原理初步" class="headerlink" title="2、SpringBoot 原理初步"></a>2、SpringBoot 原理初步</h2><p><strong>自动配置:</strong></p>
<p>​    <code>pom.xml</code></p>
<ul>
<li><code>SpingBoot-dependencies:</code> 核心依赖在父工程中</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    	&lt;--核心依赖在父工程中--&gt;</span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>在写一些或者引入 SpringBoot 的一些依赖中不需要写版本号,  就是因为有这些版本仓库</li>
</ul>
<p><strong>启动器</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>启动器即为 <code>SpringBoot</code> 的启动场景</p>
</li>
<li><p>比如 <code>spring-boot-starter-web</code> 其就会导入 web 依赖</p>
</li>
<li><p><code>SpringBoot</code> 会将所有的功能场景 都变为一个一个启动器</p>
</li>
<li><p>需要使用什么功能 就只需要找到对应的启动器就可以了</p>
</li>
</ul>
<p><strong>主程序</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">P1Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//将 SpringBoot 应用启动</span></span><br><span class="line">        SpringApplication.run(P1Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@SpringBootApplication</code> 标注这个类是一个 <code>SpringBoot</code> 的应用 获取启动类的所有配置 </p>
<ul>
<li><p>注解</p>
<ul>
<li><p>```<br>@SpringBootConfiguration : SpringBoot 的配置</p>
<pre><code>@Configuration Spring 配置类
@Component 这说明也是一个 Spring 的组件
</code></pre>
<p>@EnableAutoConfiguration : 自动配置</p>
<pre><code>@AutoConfigurationPackage 自动配置包
    @Import(&#123;Registrar.class&#125;) 导入选择器 包注册
@Import(&#123;AutoConfigurationImportSelector.class&#125;) 自动配置导入选择
</code></pre>
<p>//获取所有的配置<br>protected List<String> getCandidateConfigurations(AnnotationMetadata metadata, AnnotationAttributes attributes) </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">获取候选的配置</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line"> protected List&lt;String&gt; getCandidateConfigurations(AnnotationMetadata metadata, AnnotationAttributes attributes) &#123;</span><br><span class="line">        List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(this.getSpringFactoriesLoaderFactoryClass(), this.getBeanClassLoader());</span><br><span class="line">        Assert.notEmpty(configurations, &quot;No auto configuration classes found in META-INF/spring.factories. If you are using a custom packaging, make sure that file is correct.&quot;);</span><br><span class="line">        return configurations;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p> <strong>META-INF/spring.factories</strong> 自动配置的核心文件</p>
<p>​    <img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="C:\Users\雷神\AppData\Roaming\Typora\typora-user-images\image-20211020204954252.png" alt="image-20211020204954252"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如果这里面的条件都满足 才会生效</span><br><span class="line"><span class="meta">@ConditionalOnXXX</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>结论</strong>:  <code> SpringBoot</code> 所有的自动配置 都是在启动的时候扫描并加载 <code>spring.factories</code> 所有的自动配置类都在这里面, 但是不一定生效 要判断条件是否 成立 只要导入了对应的 <code>start</code> 就有对应的启动器了 有了启动器，自动装配就会生效 即配置成功</p>
<ol>
<li><code>SpringBoot</code>在启动时 从类路径下 <code>/META-INF/spring.factories</code> 获取指定的值</li>
<li>将这些自动配置的类导入容器, 自动配置类就会生效 进行自动配置</li>
<li>以前需要自动配置的东西 现在 <code>SpringBoot</code> 帮用户去做了</li>
<li>整合 JavaEE 解决方案和自动配置的东西都在 <code>spring-boot-autoconfigure:2.5.5</code> 这个包下</li>
<li>它会把所有需要导入的组件, 以类名的方式返回, 这些组件就会被添加到容器</li>
<li>容器中也会存在非常多的<code> XXX AutoConfiguration</code> 的文件 就是这些类给容器中导入了这个场景需要的所有组件; 并自动配置 <code>@Configuration, JavaConfig</code></li>
<li>有了自动配置类 免去了手动编写配置文件的工作</li>
</ol>
</li>
</ul>
<h2 id="3、主启动类的运行"><a href="#3、主启动类的运行" class="headerlink" title="3、主启动类的运行"></a>3、主启动类的运行</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">P1Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//SpringApplication 类</span></span><br><span class="line">        <span class="comment">//run 方法</span></span><br><span class="line">        SpringApplication.run(P1Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>分析该方法主要分为两部分, 一部分是 <code>SpringApplication</code> 的实例化, 二是 <code>run</code> 方法的执行    </p>
<h3 id="3-1、SpringApplication"><a href="#3-1、SpringApplication" class="headerlink" title="3.1、SpringApplication"></a>3.1、SpringApplication</h3><p>这个类主要做了以下四件事情:</p>
<ul>
<li>推断应用的类型是普通项目还是 <code>Web</code> 项目</li>
<li>查找并加载所有的可初始化器 设置到 <code>initializers</code> 属性中</li>
<li>找出所有的应用程序监听器 设置到 <code>listeners</code> 属性中</li>
<li>推断并设置 <code>main</code> 方法的定义类 找到运行的主类</li>
</ul>
<p><strong>查看构造器</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">SpringApplication</span><span class="params">(ResourceLoader resourceLoader, Class... primarySources)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">this</span>.webApplicationType = WebApplicationType.deduceFromClasspath();</span><br><span class="line">    <span class="keyword">this</span>.setInitializers(<span class="keyword">this</span>.getSpringFactoriesInstances();</span><br><span class="line">    <span class="keyword">this</span>.setListeners(<span class="keyword">this</span>.getSpringFactoriesInstances(ApplicationListener.class));</span><br><span class="line">    <span class="keyword">this</span>.mainApplicationClass = <span class="keyword">this</span>.deduceMainApplicationClass();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="https://img2020.cnblogs.com/i-beta/1418974/202003/1418974-20200309184347408-1065424525.png" alt="img"></p>
<h2 id="4、SpringBoot-配置"><a href="#4、SpringBoot-配置" class="headerlink" title="4、SpringBoot 配置"></a>4、SpringBoot 配置</h2><p>官方不推荐使用 <code>properties</code> 文件 推荐使用 <code>.yaml</code> 文件</p>
<h3 id="4-1、配置文件"><a href="#4-1、配置文件" class="headerlink" title="4.1、配置文件"></a>4.1、配置文件</h3><p>SpringBoot使用一个全局的配置文件 ， 配置文件名称是固定的</p>
<ul>
<li><p>application.properties</p>
</li>
<li><ul>
<li>语法结构 ：key=value</li>
</ul>
</li>
<li><p>application.yml</p>
</li>
<li><ul>
<li>语法结构 ：key：空格 value</li>
</ul>
</li>
</ul>
<p><strong>配置文件的作用 ：</strong>修改SpringBoot自动配置的默认值，因为SpringBoot在底层都给我们自动配置好了；</p>
<p>比如我们可以在配置文件中修改Tomcat 默认启动的端口号！测试一下！</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 普通的 key - value</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">cu1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对象</span></span><br><span class="line"><span class="attr">student:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cu1</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">11</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对象的行内写法</span></span><br><span class="line"><span class="attr">student:</span> &#123;<span class="attr">name:</span> <span class="string">Cu1</span>, <span class="attr">age:</span> <span class="number">11</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数组</span></span><br><span class="line"><span class="attr">pets:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">cat</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">dog</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">pig</span></span><br><span class="line"></span><br><span class="line"><span class="attr">pets:</span> [<span class="string">cat</span>, <span class="string">dog</span>, <span class="string">pig</span>]</span><br></pre></td></tr></table></figure>

<p><code>yaml</code> 可以给实体类赋值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//如果不配置使用了这个注解 就会提示报红</span><br><span class="line">//使用该注解来使用 yaml 给实体类赋值</span><br><span class="line">@ConfigurationProperties</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="C:\Users\雷神\AppData\Roaming\Typora\typora-user-images\image-20211021202656376.png" alt="image-20211021202656376"></p>
<p><strong>实体类</strong> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="comment">//如果不配置使用了这个注解 就会提示报红</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Boolean happy;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; maps;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt;lists;</span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Dog</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;旺财&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Value(&quot;3&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>yaml 配置</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cu1</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">11</span></span><br><span class="line">  <span class="attr">happy:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">birth:</span> <span class="number">2001</span><span class="string">/06/23</span></span><br><span class="line">  <span class="attr">maps:</span> &#123;<span class="attr">k1:</span> <span class="string">v1</span>, <span class="attr">K2:</span> <span class="string">v2</span>&#125;</span><br><span class="line">  <span class="attr">lists:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">code</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">music</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">girl</span></span><br><span class="line">  <span class="attr">dog:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">旺财</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p><strong>注意:</strong></p>
<p>​    关于上面的报红, 不影响使用. 但是可以点击上面的 <code>Open documentation</code> 来打开帮助文档获取了依赖并添加到<code>pom.xml</code> 中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>@ConfigurationPropertie</strong> 的作用</p>
<ul>
<li>将配置文件中配置的每一个属性的值, 映射到这个组件中;</li>
<li>告诉 <code>SpringBoot</code> 将本类中的所有属性和配置文件中相关的配置进行绑定</li>
<li>参数 <code>prefix = &quot;person&quot;</code>: 将配置文件中的 <code>person</code> 下面的所有属性一 一对应</li>
<li>只有这个组件是容器中的组件, 才能使用容器提供的 <code>@ConfigurationPropertie</code> 功能</li>
</ul>
<p><strong>注:</strong> 在配置文件中使用 <code>properties</code> 会出现乱码 这里在 <code>setting</code> 里把字体编码设置为 <code>UTF-8</code></p>
<p>使用 <code>properties</code> 进行配置 但是需要自己手动取出配置文件中的值</p>
<p>在 <code>resources</code> 下新建 <code>Cu1.properties</code></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name</span>=<span class="string">Cu1</span></span><br><span class="line"><span class="attr">age</span>=<span class="string">11</span></span><br></pre></td></tr></table></figure>

<p> <strong>实体类中</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">@Data</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">//加载指定的配置文件</span><br><span class="line">@PropertySource(value = &quot;classpath:Cu1.properties&quot;)</span><br><span class="line">public class Person &#123;</span><br><span class="line"></span><br><span class="line">    //SPEL 表达式取出配置文件的值</span><br><span class="line">    @Value(&quot;$&#123;name&#125;&quot;)</span><br><span class="line">    private String name;</span><br><span class="line">    private Integer age;</span><br><span class="line">    private Boolean happy;</span><br><span class="line">    private Date birthday;</span><br><span class="line">    private Map&lt;String, Object&gt; maps;</span><br><span class="line">    private List&lt;Object&gt;lists;</span><br><span class="line">    private Dog dog;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="https://img2020.cnblogs.com/i-beta/1418974/202003/1418974-20200310172022780-374285033.png" alt="img"></p>
<ol>
<li><p>@ConfigurationProperties只需要写一次即可 ， @Value则需要每个字段都添加</p>
</li>
<li><p>松散绑定：这个什么意思呢? 比如我的yml中写的last-name，这个和lastName是一样的， - 后面跟着的字母默认是大写的。这就是松散绑定。可以测试一下</p>
</li>
<li><p>JSR303数据校验 ， 这个就是我们可以在字段是增加一层过滤器验证 ， 可以保证数据的合法性</p>
</li>
<li><p>复杂类型封装，yml中可以封装对象 ， 使用value就不支持</p>
</li>
</ol>
<p><strong>结论：</strong></p>
<ul>
<li><p>配置yml和配置properties都可以获取到值 ， 强烈推荐 yml；</p>
</li>
<li><p>如果我们在某个业务中，只需要获取配置文件中的某个值，可以使用一下 @value；</p>
</li>
<li><p>如果说，我们专门编写了一个JavaBean来和配置文件进行一一映射，就直接@configurationProperties，不要犹豫！</p>
</li>
</ul>
<h3 id="4-2、JSR303数据校验"><a href="#4-2、JSR303数据校验" class="headerlink" title="4.2、JSR303数据校验"></a>4.2、JSR303数据校验</h3><h4 id="先看看如何使用"><a href="#先看看如何使用" class="headerlink" title="先看看如何使用"></a>先看看如何使用</h4><p>Springboot中可以用@validated来校验数据，如果数据异常则会统一抛出异常，方便异常中心统一处理。我们这里来写个注解让我们的name只能支持Email格式；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Component //注册bean</span><br><span class="line">@ConfigurationProperties(prefix = &quot;person&quot;)</span><br><span class="line">@Validated  //数据校验</span><br><span class="line">public class Person &#123;</span><br><span class="line"></span><br><span class="line">    @Email(message=&quot;邮箱格式错误&quot;) //name必须是邮箱格式</span><br><span class="line">    private String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 运行结果 ：default message [不是一个合法的电子邮件地址];</p>
<p> <img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="https://img2020.cnblogs.com/i-beta/1418974/202003/1418974-20200311124206128-825984089.png" alt="img"></p>
<p> <strong>使用数据校验，可以保证数据的正确性；</strong></p>
<h5 id="常见参数"><a href="#常见参数" class="headerlink" title="常见参数"></a>常见参数</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NotNull(message=&quot;名字不能为空&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String userName;</span><br><span class="line"><span class="meta">@Max(value=120,message=&quot;年龄最大不能查过120&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"><span class="meta">@Email(message=&quot;邮箱格式错误&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">空检查</span><br><span class="line"><span class="meta">@Null</span>       验证对象是否为<span class="keyword">null</span></span><br><span class="line"><span class="meta">@NotNull</span>    验证对象是否不为<span class="keyword">null</span>, 无法查检长度为<span class="number">0</span>的字符串</span><br><span class="line"><span class="meta">@NotBlank</span>   检查约束字符串是不是Null还有被Trim的长度是否大于<span class="number">0</span>,只对字符串,且会去掉前后空格.</span><br><span class="line"><span class="meta">@NotEmpty</span>   检查约束元素是否为NULL或者是EMPTY.</span><br><span class="line">    </span><br><span class="line">Booelan检查</span><br><span class="line"><span class="meta">@AssertTrue</span>     验证 Boolean 对象是否为 <span class="keyword">true</span>  </span><br><span class="line"><span class="meta">@AssertFalse</span>    验证 Boolean 对象是否为 <span class="keyword">false</span>  </span><br><span class="line">    </span><br><span class="line">长度检查</span><br><span class="line"><span class="meta">@Size(min=, max=)</span> 验证对象（Array,Collection,Map,String）长度是否在给定的范围之内  </span><br><span class="line"><span class="meta">@Length(min=, max=)</span> string is between min and max included.</span><br><span class="line"></span><br><span class="line">日期检查</span><br><span class="line"><span class="meta">@Past</span>       验证 Date 和 Calendar 对象是否在当前时间之前  </span><br><span class="line"><span class="meta">@Future</span>     验证 Date 和 Calendar 对象是否在当前时间之后  </span><br><span class="line"><span class="meta">@Pattern</span>    验证 String 对象是否符合正则表达式的规则</span><br><span class="line"></span><br><span class="line">.......等等</span><br><span class="line">除此以外，我们还可以自定义一些数据校验规则</span><br></pre></td></tr></table></figure>

<h3 id="4-3、多环境切换"><a href="#4-3、多环境切换" class="headerlink" title="4.3、多环境切换"></a>4.3、多环境切换</h3><p>profile是Spring对不同环境提供不同配置功能的支持，可以通过激活不同的环境版本，实现快速切换环境；</p>
<h5 id="4-3-1、配置文件"><a href="#4-3-1、配置文件" class="headerlink" title="4.3.1、配置文件"></a>4.3.1、配置文件</h5><p>我们在主配置文件编写的时候，文件名可以是 application-{profile}.properties/yml , 用来指定多个环境版本；</p>
<p><strong>例如：</strong></p>
<p>application-test.properties 代表测试环境配置</p>
<p>application-dev.properties 代表开发环境配置</p>
<p>但是Springboot并不会直接启动这些配置文件，它<strong>默认使用application.properties主配置文件</strong>；</p>
<p>我们需要通过一个配置来选择需要激活的环境：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#比如在配置文件中指定使用dev环境，我们可以通过设置不同的端口号进行测试；</span><br><span class="line">#我们启动SpringBoot，就可以看到已经切换到dev下的配置了；</span><br><span class="line">spring.profiles.active=dev</span><br></pre></td></tr></table></figure>

<h4 id="4-3-2、yaml的多文档块"><a href="#4-3-2、yaml的多文档块" class="headerlink" title="4.3.2、yaml的多文档块"></a>4.3.2、yaml的多文档块</h4><p>和properties配置文件中一样，但是使用yml去实现不需要创建多个配置文件，更加方便了 !</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"><span class="comment">#选择要激活那个环境块</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">prod</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8083</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span> <span class="comment">#配置环境的名称</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8084</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">prod</span>  <span class="comment">#配置环境的名称</span></span><br></pre></td></tr></table></figure>

<p><strong>注意：如果yml和properties同时都配置了端口，并且没有激活其他环境 ， 默认会使用properties配置文件的！</strong></p>
<p><strong>properties 文件优先级最低会导致配置覆盖</strong></p>
<h4 id="4-3-3、配置文件加载位置"><a href="#4-3-3、配置文件加载位置" class="headerlink" title="4.3.3、配置文件加载位置"></a>4.3.3、配置文件加载位置</h4><p><strong>外部加载配置文件的方式十分多，我们选择最常用的即可，在开发的资源文件中进行配置！</strong></p>
<p>官方外部配置文件说明参考文档</p>
<p><img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="https://img2020.cnblogs.com/i-beta/1418974/202003/1418974-20200311124351635-1979908122.png" alt="img"></p>
<p>springboot 启动会扫描以下位置的application.properties或者application.yml文件作为Spring boot的默认配置文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">优先级1：项目路径下的config文件夹配置文件</span><br><span class="line">优先级2：项目路径下配置文件</span><br><span class="line">优先级3：资源路径下的config文件夹配置文件</span><br><span class="line">优先级4：资源路径下配置文件</span><br></pre></td></tr></table></figure>

<p>优先级由高到底，高优先级的配置会覆盖低优先级的配置；</p>
<p><strong>SpringBoot会从这四个位置全部加载主配置文件；互补配置；</strong></p>
<p>我们在最低级的配置文件中设置一个项目访问路径的配置来测试互补问题；</p>
<h4 id="4-3-4、拓展，运维小技巧"><a href="#4-3-4、拓展，运维小技巧" class="headerlink" title="4.3.4、拓展，运维小技巧"></a>4.3.4、拓展，运维小技巧</h4><p>指定位置加载配置文件</p>
<p>我们还可以通过spring.config.location来改变默认的配置文件位置</p>
<p>项目打包好以后，我们可以使用命令行参数的形式，启动项目的时候来指定配置文件的新位置；这种情况，一般是后期运维做的多，相同配置，外部指定的配置文件优先级最高</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar spring-boot-config.jar --spring.config.location=F:/application.properties</span><br></pre></td></tr></table></figure>

<h3 id="4-4、自动装配原理深入"><a href="#4-4、自动装配原理深入" class="headerlink" title="4.4、自动装配原理深入"></a>4.4、自动装配原理深入</h3><h4 id="4-4-1、分析自动配置原理"><a href="#4-4-1、分析自动配置原理" class="headerlink" title="4.4.1、分析自动配置原理"></a>4.4.1、分析自动配置原理</h4><p>我们以 <strong>HttpEncodingAutoConfiguration（Http编码自动配置）</strong>为例解释自动配置原理；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//表示这是一个配置类，和以前编写的配置文件一样，也可以给容器中添加组件；</span></span><br><span class="line"><span class="meta">@Configuration</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">//启动指定类的ConfigurationProperties功能；</span></span><br><span class="line">  <span class="comment">//进入这个HttpProperties查看，将配置文件中对应的值和HttpProperties绑定起来；</span></span><br><span class="line">  <span class="comment">//并把HttpProperties加入到ioc容器中</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;HttpProperties.class&#125;)</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">//Spring底层@Conditional注解</span></span><br><span class="line">  <span class="comment">//根据不同的条件判断，如果满足指定的条件，整个配置类里面的配置就会生效；</span></span><br><span class="line">  <span class="comment">//这里的意思就是判断当前应用是否是web应用，如果是，当前配置类生效</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(</span></span><br><span class="line"><span class="meta">    type = Type.SERVLET</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//判断当前项目有没有这个类CharacterEncodingFilter；SpringMVC中进行乱码解决的过滤器；</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;CharacterEncodingFilter.class&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//判断配置文件中是否存在某个配置：spring.http.encoding.enabled；</span></span><br><span class="line">  <span class="comment">//如果不存在，判断也是成立的</span></span><br><span class="line">  <span class="comment">//即使我们配置文件中不配置pring.http.encoding.enabled=true，也是默认生效的；</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(</span></span><br><span class="line"><span class="meta">    prefix = &quot;spring.http.encoding&quot;,</span></span><br><span class="line"><span class="meta">    value = &#123;&quot;enabled&quot;&#125;,</span></span><br><span class="line"><span class="meta">    matchIfMissing = true</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpEncodingAutoConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="comment">//他已经和SpringBoot的配置文件映射了</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Encoding properties;</span><br><span class="line">    <span class="comment">//只有一个有参构造器的情况下，参数的值就会从容器中拿</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HttpEncodingAutoConfiguration</span><span class="params">(HttpProperties properties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.properties = properties.getEncoding();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//给容器中添加一个组件，这个组件的某些值需要从properties中获取</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span> <span class="comment">//判断容器没有这个组件？</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CharacterEncodingFilter <span class="title">characterEncodingFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        CharacterEncodingFilter filter = <span class="keyword">new</span> OrderedCharacterEncodingFilter();</span><br><span class="line">        filter.setEncoding(<span class="keyword">this</span>.properties.getCharset().name());</span><br><span class="line">        filter.setForceRequestEncoding(<span class="keyword">this</span>.properties.shouldForce(org.springframework.boot.autoconfigure.http.HttpProperties.Encoding.Type.REQUEST));</span><br><span class="line">        filter.setForceResponseEncoding(<span class="keyword">this</span>.properties.shouldForce(org.springframework.boot.autoconfigure.http.HttpProperties.Encoding.Type.RESPONSE));</span><br><span class="line">        <span class="keyword">return</span> filter;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//。。。。。。。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>一句话总结 ：根据当前不同的条件判断，决定这个配置类是否生效！</strong></p>
<ul>
<li><p>一但这个配置类生效；这个配置类就会给容器中添加各种组件；</p>
</li>
<li><p>这些组件的属性是从对应的properties类中获取的，这些类里面的每一个属性又是和配置文件绑定的；</p>
</li>
<li><p>所有在配置文件中能配置的属性都是在xxxxProperties类中封装着；</p>
</li>
<li><p>配置文件能配置什么就可以参照某个功能对应的这个属性类</p>
<p>我们去配置文件里面试试前缀，看提示!</p>
</li>
</ul>
<p><img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="https://img2020.cnblogs.com/i-beta/1418974/202003/1418974-20200312125622060-142770598.png" alt="img"></p>
<p><strong>这就是自动装配的原理!</strong></p>
<h4 id="4-4-2、精髓"><a href="#4-4-2、精髓" class="headerlink" title="4.4.2、精髓"></a>4.4.2、精髓</h4><p>1、SpringBoot启动会加载大量的自动配置类</p>
<p>2、我们看我们需要的功能有没有在SpringBoot默认写好的自动配置类当中；</p>
<p>3、我们再来看这个自动配置类中到底配置了哪些组件；（只要我们要用的组件存在在其中，我们就不需要再手动配置了）</p>
<p>4、给容器中自动配置类添加组件的时候，会从properties类中获取某些属性。我们只需要在配置文件中指定这些属性的值即可；</p>
<p><strong>xxxxAutoConfigurartion：自动配置类；</strong>给容器中添加组件</p>
<p><strong>xxxxProperties:封装配置文件中相关属性；</strong></p>
<h4 id="4-4-3、了解：-Conditional"><a href="#4-4-3、了解：-Conditional" class="headerlink" title="4.4.3、了解：@Conditional"></a>4.4.3、了解：@Conditional</h4><p>了解完自动装配的原理后，我们来关注一个细节问题，<strong>自动配置类必须在一定的条件下才能生效；</strong></p>
<p><strong>@Conditional派生注解（Spring注解版原生的@Conditional作用）</strong></p>
<p>作用：必须是@Conditional指定的条件成立，才给容器中添加组件，配置配里面的所有内容才生效；</p>
<p><img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="https://img2020.cnblogs.com/i-beta/1418974/202003/1418974-20200312125749368-824052257.png" alt="img"></p>
<p> <strong>那么多的自动配置类，必须在一定的条件下才能生效；也就是说，我们加载了这么多的配置类，但不是所有的都生效了。</strong></p>
<p>我们怎么知道哪些自动配置类生效？</p>
<p><strong>我们可以通过启用 debug=true属性；来让控制台打印自动配置报告，这样我们就可以很方便的知道哪些自动配置类生效；</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#开启springboot的调试类</span><br><span class="line">debug=<span class="keyword">true</span></span><br></pre></td></tr></table></figure>

<p><strong>Positive matches:（自动配置类启用的：正匹配）</strong></p>
<p><strong>Negative matches:（没有启动，没有匹配成功的自动配置类：负匹配）</strong></p>
<p><strong>Unconditional classes: （没有条件的类）</strong></p>
<h2 id="5、SpringBoot-Web-开发"><a href="#5、SpringBoot-Web-开发" class="headerlink" title="5、SpringBoot Web 开发"></a>5、SpringBoot Web 开发</h2><p><strong>要解决的问题:</strong></p>
<ul>
<li>导入静态资源</li>
<li>首页</li>
<li>jsp 模板引擎 Thymeleaf</li>
<li>装配和扩展 SpringMVC</li>
<li>增删改查</li>
<li>拦截器</li>
<li>国际化</li>
</ul>
<h3 id="5-1、静态资源导入"><a href="#5-1、静态资源导入" class="headerlink" title="5.1、静态资源导入"></a>5.1、静态资源导入</h3><h4 id="5-1-1、静态资源映射规则"><a href="#5-1-1、静态资源映射规则" class="headerlink" title="5.1.1、静态资源映射规则"></a>5.1.1、静态资源映射规则</h4><p><strong>首先，我们搭建一个普通的SpringBoot项目，回顾一下HelloWorld程序！</strong></p>
<p>写请求非常简单，那我们要引入我们前端资源，我们项目中有许多的静态资源，比如css，js等文件，这个SpringBoot怎么处理呢？</p>
<p>如果我们是一个web应用，我们的main下会有一个webapp，我们以前都是将所有的页面导在这里面的，对吧！但是我们现在的pom呢，打包方式是为jar的方式，那么这种方式SpringBoot能不能来给我们写页面呢？当然是可以的，但是SpringBoot对于静态资源放置的位置，是有规定的！</p>
<p><strong>我们先来聊聊这个静态资源映射规则：</strong></p>
<p>SpringBoot中，SpringMVC的web配置都在 WebMvcAutoConfiguration 这个配置类里面；</p>
<p>我们可以去看看 WebMvcAutoConfigurationAdapter 中有很多配置方法；</p>
<p>有一个方法：addResourceHandlers 添加资源处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">        <span class="comment">// 已禁用默认资源处理</span></span><br><span class="line">        logger.debug(<span class="string">&quot;Default resource handling disabled&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 缓存控制</span></span><br><span class="line">    Duration cachePeriod = <span class="keyword">this</span>.resourceProperties.getCache().getPeriod();</span><br><span class="line">    CacheControl cacheControl = <span class="keyword">this</span>.resourceProperties.getCache().getCachecontrol().toHttpCacheControl();</span><br><span class="line">    <span class="comment">// webjars 配置</span></span><br><span class="line">    <span class="keyword">if</span> (!registry.hasMappingForPattern(<span class="string">&quot;/webjars/**&quot;</span>)) &#123;</span><br><span class="line">        customizeResourceHandlerRegistration(registry.addResourceHandler(<span class="string">&quot;/webjars/**&quot;</span>)</span><br><span class="line">                                             .addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>)</span><br><span class="line">                                             .setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 静态资源配置</span></span><br><span class="line">    String staticPathPattern = <span class="keyword">this</span>.mvcProperties.getStaticPathPattern();</span><br><span class="line">    <span class="keyword">if</span> (!registry.hasMappingForPattern(staticPathPattern)) &#123;</span><br><span class="line">        customizeResourceHandlerRegistration(registry.addResourceHandler(staticPathPattern)</span><br><span class="line">                                             .addResourceLocations(getResourceLocations(<span class="keyword">this</span>.resourceProperties.getStaticLocations()))</span><br><span class="line">                                             .setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>读一下源代码：比如所有的 <code>/webjars/** </code>， 都需要去 <code>classpath:/META-INF/resources/webjars/</code> 找对应的资源；</p>
<h4 id="什么是webjars"><a href="#什么是webjars" class="headerlink" title="什么是webjars"></a>什么是webjars</h4><p><code>Webjars</code> 本质就是以jar包的方式引入我们的静态资源 ， 我们以前要导入一个静态资源文件，直接导入即可。</p>
<p>使用 <code>SpringBoot</code> 需要使用 <code>Webjars</code>，我们可以去搜索一下：</p>
<p>网站：<code>https://www.webjars.org</code></p>
<p>要使用jQuery，我们只要要引入jQuery对应版本的pom依赖即可！</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>导入完毕，查看webjars目录结构，并访问Jquery.js文件！</p>
<p><img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="https://img2020.cnblogs.com/i-beta/1418974/202003/1418974-20200317124625447-915223066.png" alt="img"></p>
<p>访问：只要是静态资源，<code>SpringBoot</code> 就会去对应的路径寻找资源，我们这里访问：<code>http://localhost:8080/webjars/jquery/3.4.1/jquery.js</code></p>
<h4 id="5-1-2、第二种静态资源映射规则"><a href="#5-1-2、第二种静态资源映射规则" class="headerlink" title="5.1.2、第二种静态资源映射规则"></a>5.1.2、第二种静态资源映射规则</h4><p>项目中使用自己的静态资源该怎么导入；</p>
<p>我们去找 <code>staticPathPattern</code> 发现第二种映射规则 ：<code>/**</code> , 访问当前的项目任意资源，它会去找 <code>resourceProperties</code> 这个类，我们可以点进去看一下分析：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 进入方法public String[] getStaticLocations() &#123;    return this.staticLocations;&#125;// 找到对应的值private String[] staticLocations = CLASSPATH_RESOURCE_LOCATIONS;// 找到路径private static final String[] CLASSPATH_RESOURCE_LOCATIONS = &#123;     &quot;classpath:/META-INF/resources/&quot;, 	&quot;classpath:/resources/&quot;,     &quot;classpath:/static/&quot;,     &quot;classpath:/public/&quot; &#125;;</span></span><br></pre></td></tr></table></figure>

<p><code>ResourceProperties</code> 可以设置和我们静态资源有关的参数；这里面指向了它会去寻找资源的文件夹，即上面数组的内容。</p>
<p>所以得出结论，以下四个目录存放的静态资源可以被我们识别：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;classpath:/META-INF/resources/&quot;&quot;classpath:/resources/&quot;&quot;classpath:/static/&quot;&quot;classpath:/public/&quot;</span><br></pre></td></tr></table></figure>

<p>我们可以在 <code>resources</code> 根目录下新建对应的文件夹，都可以存放我们的静态文件；</p>
<p>比如我们访问<code>http://localhost:8080/1.js</code>, 他就会去这些文件夹中寻找对应的静态资源文件；</p>
<h4 id="5-1-3、自定义静态资源路径"><a href="#5-1-3、自定义静态资源路径" class="headerlink" title="5.1.3、自定义静态资源路径"></a>5.1.3、自定义静态资源路径</h4><p>我们也可以自己通过配置文件来指定一下，哪些文件夹是需要我们放静态资源文件的，在 <code>application.properties</code>中配置；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.resources.static-locations=classpath:/coding/,classpath:/kuang/</span><br></pre></td></tr></table></figure>

<p>一旦自己定义了静态文件夹的路径，原来的自动配置就都会失效了！</p>
<h4 id="5-1-4、总结"><a href="#5-1-4、总结" class="headerlink" title="5.1.4、总结:"></a>5.1.4、总结:</h4><ul>
<li><p>参考源码推测出, 如果使用了自定义的配置文件并指定其为静态资源文件目录 那么默认的静态资源目录就会失效</p>
</li>
<li><p>在利用 <code>url</code> 访问静态资源目录时 首先判断是不是访问 <code>/webjars/**</code>  如果是, 就会将 <code>url</code> 拼接到 <code>classpath:/META-INF/resources/webjars/</code> 下的静态资源目录下; 否则就会直接去按照第二种静态资源目录的规则去寻找</p>
</li>
<li><p>第二种静态资源目录的优先级</p>
<p><code>resources</code>  &gt; <code>static(默认)</code> &gt; <code>public</code></p>
</li>
</ul>
<h3 id="5-2、首页和图标定制"><a href="#5-2、首页和图标定制" class="headerlink" title="5.2、首页和图标定制"></a>5.2、首页和图标定制</h3><h4 id="5-2-1、首页处理"><a href="#5-2-1、首页处理" class="headerlink" title="5.2.1、首页处理"></a>5.2.1、首页处理</h4><p>继续向下看源码! 可以看到一个欢迎页的映射, 就是我们的首页!</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Beanpublic</span> <span class="function">WelcomePageHandlerMapping <span class="title">welcomePageHandlerMapping</span><span class="params">(ApplicationContext applicationContext,                                                           FormattingConversionService mvcConversionService,                                                           ResourceUrlProvider mvcResourceUrlProvider)</span> </span>&#123;    WelcomePageHandlerMapping welcomePageHandlerMapping = <span class="keyword">new</span> WelcomePageHandlerMapping(  <span class="keyword">new</span> TemplateAvailabilityProviders(applicationContext), applicationContext, getWelcomePage(), <span class="comment">// getWelcomePage 获得欢迎页        this.mvcProperties.getStaticPathPattern());    welcomePageHandlerMapping.setInterceptors(getInterceptors(mvcConversionService, mvcResourceUrlProvider));    return welcomePageHandlerMapping;&#125;</span></span><br></pre></td></tr></table></figure>

<p>点进去继续看 <code>getWelcomPage()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Optional&lt;Resource&gt; <span class="title">getWelcomePage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String[] locations = getResourceLocations(<span class="keyword">this</span>.resourceProperties.getStaticLocations());</span><br><span class="line">    <span class="comment">// ::是java8 中新引入的运算符</span></span><br><span class="line">    <span class="comment">// Class::function的时候function是属于Class的，应该是静态方法。</span></span><br><span class="line">    <span class="comment">// this::function的funtion是属于这个对象的。</span></span><br><span class="line">    <span class="comment">// 简而言之，就是一种语法糖而已，是一种简写</span></span><br><span class="line">    <span class="keyword">return</span> Arrays.stream(locations).map(<span class="keyword">this</span>::getIndexHtml).filter(<span class="keyword">this</span>::isReadable).findFirst();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 欢迎页就是一个location下的的 index.html 而已</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Resource <span class="title">getIndexHtml</span><span class="params">(String location)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.resourceLoader.getResource(location + <span class="string">&quot;index.html&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于设置欢迎页, 可以放在静态资源文件夹下的 <code>index.html</code> 文件将会被 <code>/**</code> 映射 一般都放在 <code>resouces/static</code> 文件夹下</p>
<p>比如访问 <code> http://localhost:8080/</code> ，就会找静态资源文件夹下的<code> index.html</code></p>
<p>新建一个<code>index.html</code>，在我们上面的3个目录中任意一个；然后访问测试  <code>http://localhost:8080/ </code>看结果！</p>
<p>对于网站图标 如果使用的是 <code>SpringBoot2.x</code> 之后的版本 设置关闭默认图标就失效了</p>
<h4 id="5-2-2、图标定制"><a href="#5-2-2、图标定制" class="headerlink" title="5.2.2、图标定制"></a>5.2.2、图标定制</h4><p>后来在网上搜怎么自定义图标 找到了一篇博客 但是没有生效在这里将博客链接贴一下, 有兴趣可以去尝试一下,</p>
<p>这个并不重要 <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/ead2269d307f">关于 SpringBoot2.x之后版本的自定义图标</a></p>
<h3 id="5-3、模板引擎-Thymeleaf"><a href="#5-3、模板引擎-Thymeleaf" class="headerlink" title="5.3、模板引擎 Thymeleaf"></a>5.3、模板引擎 Thymeleaf</h3><h4 id="5-3-1、模板引擎"><a href="#5-3-1、模板引擎" class="headerlink" title="5.3.1、模板引擎"></a>5.3.1、模板引擎</h4><p>​    前端交给我们的页面，是 <code>html</code> 页面。如果是我们以前开发，我们需要把他们转成 <code>jsp</code> 页面，<code>jsp</code>好处就是当我们查出一些数据转发到 <code>JSP</code> 页面以后，我们可以用jsp轻松实现数据的显示，及交互等。</p>
<p><code>jsp</code> 支持非常强大的功能，包括能写 <code>Java</code> 代码，但是呢，我们现在的这种情况，<code>SpringBoot</code> 这个项目首先是以 <code>jar</code> 的方式，不是 <code>war</code>，像第二，我们用的还是嵌入式的 <code>Tomcat</code>，所以呢，<strong>他现在默认是不支持jsp的</strong>。</p>
<p>那不支持 <code>jsp</code> ，如果我们直接用纯静态页面的方式，那给我们开发会带来非常大的麻烦，那怎么办呢？</p>
<p><strong>SpringBoot 推荐你可以来使用模板引擎：</strong></p>
<p>模板引擎，我们其实大家听到很多，其实jsp就是一个模板引擎，还有用的比较多的 <code>freemarker</code> ，包括<code>SpringBoot</code> 给我们推荐的 <code>Thymeleaf</code>，模板引擎有非常多，但再多的模板引擎，他们的思想都是一样的，什么样一个思想呢我们来看一下这张图：</p>
<p><img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="https://img2020.cnblogs.com/blog/1418974/202003/1418974-20200318131836219-1993983957.png" alt="img"></p>
<p>模板引擎的作用就是我们来写一个页面模板，比如有些值呢，是动态的，我们写一些表达式。而这些值，从哪来呢，就是我们在后台封装一些数据。然后把这个模板和这个数据交给我们模板引擎，模板引擎按照我们这个数据帮你把这表达式解析、填充到我们指定的位置，然后把这个数据最终生成一个我们想要的内容给我们写出去，这就是我们这个模板引擎，不管是jsp还是其他模板引擎，都是这个思想。只不过呢，就是说不同模板引擎之间，他们可能这个语法有点不一样。其他的我就不介绍了，我主要来介绍一下 <code>SpringBoot</code> 给我们推荐的 <code>Thymeleaf</code> 模板引擎，这模板引擎呢，是一个高级语言的模板引擎，他的这个语法更简单。而且呢，功能更强大。</p>
<h4 id="5-3-2、引入Thymeleaf"><a href="#5-3-2、引入Thymeleaf" class="headerlink" title="5.3.2、引入Thymeleaf"></a>5.3.2、引入Thymeleaf</h4><p>怎么引入呢，对于springboot来说，什么事情不都是一个start的事情嘛，我们去在项目中引入一下。给大家三个网址：</p>
<p><a target="_blank" rel="noopener" href="https://www.thymeleaf.org/">Thymeleaf 官网</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/thymeleaf/thymeleaf">Thymeleaf 在Github 的主页</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.2.5.RELEASE/reference/htmlsingle/#using-boot-starter">Spring官方文档:找到对应的版本</a></p>
<p>导入 <code>pom</code> 依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--thymeleaf--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="5-3-4、Thymeleaf分析"><a href="#5-3-4、Thymeleaf分析" class="headerlink" title="5.3.4、Thymeleaf分析"></a>5.3.4、Thymeleaf分析</h4><p>前面呢，我们已经引入了 <code>Thymeleaf</code>，那这个要怎么使用呢？</p>
<p>我们首先得按照 <code>SpringBoot</code> 的自动配置原理看一下我们这个<code>Thymeleaf</code>的自动配置规则，在按照那个规则，我们进行使用。</p>
<p>我们去找一下 <code>Thymeleaf</code> 的自动配置类：<code>ThymeleafProperties</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.thymeleaf&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThymeleafProperties</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Charset DEFAULT_ENCODING;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_PREFIX = <span class="string">&quot;classpath:/templates/&quot;</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_SUFFIX = <span class="string">&quot;.html&quot;</span>;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">boolean</span> checkTemplate = <span class="keyword">true</span>;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">boolean</span> checkTemplateLocation = <span class="keyword">true</span>;</span><br><span class="line">   <span class="keyword">private</span> String prefix = <span class="string">&quot;classpath:/templates/&quot;</span>;</span><br><span class="line">   <span class="keyword">private</span> String suffix = <span class="string">&quot;.html&quot;</span>;</span><br><span class="line">   <span class="keyword">private</span> String mode = <span class="string">&quot;HTML&quot;</span>;</span><br><span class="line">   <span class="keyword">private</span> Charset encoding;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以在其中看到默认的前缀和后缀！</p>
<p>只需要把需要的 <code>html</code> 页面放在类路径下的 <code>templates</code> 下，<code>thymeleaf</code> 就可以代替我们自动渲染了。</p>
<p>使用 <code>thymeleaf</code> 什么都不需要配置，只需要将其放在指定的文件夹下即可！</p>
<h4 id="5-3-5、测试"><a href="#5-3-5、测试" class="headerlink" title="5.3.5、测试"></a>5.3.5、测试</h4><p><strong>test.html</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>test<span class="comment">&lt;!--所有的 html 元素都可以被 thymeleaf 替换接管 th:元素名--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;msg&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>Controller</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在 template 目录下的所有页面 只能通过 Controller 来跳转</span></span><br><span class="line"><span class="comment">// 这个需要模板引擎支持</span></span><br><span class="line"><span class="meta">@Controllerpublic</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> </span>&#123;</span><br><span class="line">   <span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">      model.addAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;helloSpringBoot&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;test&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-3-6、Thymeleaf-语法"><a href="#5-3-6、Thymeleaf-语法" class="headerlink" title="5.3.6、Thymeleaf 语法"></a>5.3.6、Thymeleaf 语法</h4><p>学习语法, 最好是参考官方文档:  <a target="_blank" rel="noopener" href="https://www.thymeleaf.org/">Thymeleaf 官网</a></p>
<ol>
<li>修改测试请求，增加数据传输；</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/t1&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//存入数据    </span></span><br><span class="line">  model.addAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;Hello,Thymeleaf&quot;</span>);</span><br><span class="line">  <span class="comment">//classpath:/templates/test.html    </span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;test&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>要使用thymeleaf，需要在html文件中导入命名空间的约束，方便提示; </p>
<p>去官方文档的#3中看一下命名空间拿来过来：</p>
</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xmlns:th=&quot;http://www.thymeleaf.org&quot;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>编写下前端页面</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>test<span class="comment">&lt;!--所有的 html 元素都可以被 thymeleaf 替换接管 th: 元素名--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;msg&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">th:each</span>=<span class="string">&quot;user:$&#123;users&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>对于语法的深入</strong></p>
<p><strong>1. 可以使用任意的 th:attr 来替换Html中原生属性的值！</strong></p>
<p><img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="https://img2020.cnblogs.com/blog/1418974/202003/1418974-20200318132240409-1760266878.png" alt="img"></p>
<p><strong>2. 能写哪些表达式</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">Simple expressions:（表达式语法）</span><br><span class="line">Variable Expressions: $&#123;...&#125;：获取变量值；OGNL；</span><br><span class="line">    1）、获取对象的属性、调用方法</span><br><span class="line">    2）、使用内置的基本对象：#18</span><br><span class="line">         #ctx : the context object.</span><br><span class="line">         #vars: the context variables.</span><br><span class="line">         #locale : the context locale.</span><br><span class="line">         #request : (only in Web Contexts) the HttpServletRequest object.</span><br><span class="line">         #response : (only in Web Contexts) the HttpServletResponse object.</span><br><span class="line">         #session : (only in Web Contexts) the HttpSession object.</span><br><span class="line">         #servletContext : (only in Web Contexts) the ServletContext object.</span><br><span class="line"></span><br><span class="line">    3）、内置的一些工具对象：</span><br><span class="line">　　　　　　#execInfo : information about the template being processed.</span><br><span class="line">　　　　　　#uris : methods for escaping parts of URLs/URIs</span><br><span class="line">　　　　　　#conversions : methods for executing the configured conversion service (if any).</span><br><span class="line">　　　　　　#dates : methods for java.util.Date objects: formatting, component extraction, etc.</span><br><span class="line">　　　　　　#calendars : analogous to #dates , but for java.util.Calendar objects.</span><br><span class="line">　　　　　　#numbers : methods for formatting numeric objects.</span><br><span class="line">　　　　　　#strings : methods for String objects: contains, startsWith, prepending/appending, etc.</span><br><span class="line">　　　　　　#objects : methods for objects in general.</span><br><span class="line">　　　　　　#bools : methods for boolean evaluation.</span><br><span class="line">　　　　　　#arrays : methods for arrays.</span><br><span class="line">　　　　　　#lists : methods for lists.</span><br><span class="line">　　　　　　#sets : methods for sets.</span><br><span class="line">　　　　　　#maps : methods for maps.</span><br><span class="line">　　　　　　#aggregates : methods for creating aggregates on arrays or collections.</span><br><span class="line">==================================================================================</span><br><span class="line"></span><br><span class="line">  Selection Variable Expressions: *&#123;...&#125;：选择表达式：和$&#123;&#125;在功能上是一样；</span><br><span class="line">  Message Expressions: #&#123;...&#125;：获取国际化内容</span><br><span class="line">  Link URL Expressions: @&#123;...&#125;：定义URL；</span><br><span class="line">  Fragment Expressions: ~&#123;...&#125;：片段引用表达式</span><br><span class="line"></span><br><span class="line">Literals（字面量）</span><br><span class="line">      Text literals: &#x27;one text&#x27; , &#x27;Another one!&#x27; ,…</span><br><span class="line">      Number literals: 0 , 34 , 3.0 , 12.3 ,…</span><br><span class="line">      Boolean literals: true , false</span><br><span class="line">      Null literal: null</span><br><span class="line">      Literal tokens: one , sometext , main ,…</span><br><span class="line">      </span><br><span class="line">Text operations:（文本操作）</span><br><span class="line">    String concatenation: +</span><br><span class="line">    Literal substitutions: |The name is $&#123;name&#125;|</span><br><span class="line">    </span><br><span class="line">Arithmetic operations:（数学运算）</span><br><span class="line">    Binary operators: + , - , * , / , %</span><br><span class="line">    Minus sign (unary operator): -</span><br><span class="line">    </span><br><span class="line">Boolean operations:（布尔运算）</span><br><span class="line">    Binary operators: and , or</span><br><span class="line">    Boolean negation (unary operator): ! , not</span><br><span class="line">    </span><br><span class="line">Comparisons and equality:（比较运算）</span><br><span class="line">    Comparators: &gt; , &lt; , &gt;= , &lt;= ( gt , lt , ge , le )</span><br><span class="line">    Equality operators: == , != ( eq , ne )</span><br><span class="line">    </span><br><span class="line">Conditional operators:条件运算（三元运算符）</span><br><span class="line">    If-then: (if) ? (then)</span><br><span class="line">    If-then-else: (if) ? (then) : (else)</span><br><span class="line">    Default: (value) ?: (defaultvalue)</span><br><span class="line">    </span><br><span class="line">Special tokens:</span><br><span class="line">    No-Operation: _</span><br></pre></td></tr></table></figure>

<p><strong>测试</strong> 循环取出数组中内容</p>
<p><strong>Controller</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controllerpublic</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> </span>&#123;</span><br><span class="line">   <span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">      model.addAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;helloSpringBoot&quot;</span>);</span><br><span class="line">      model.addAttribute(<span class="string">&quot;users&quot;</span>, Arrays.asList(<span class="string">&quot;Cu1&quot;</span>, <span class="string">&quot;Cu2&quot;</span>));</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;test&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>html</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>test<span class="comment">&lt;!--所有的 html 元素都可以被 thymeleaf 替换接管 th: 元素名--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;msg&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">th:each</span>=<span class="string">&quot;user:$&#123;users&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-4、SpringMVC-配置"><a href="#5-4、SpringMVC-配置" class="headerlink" title="5.4、SpringMVC 配置"></a>5.4、SpringMVC 配置</h3><h5 id="5-4-1、MVC自动配置原理"><a href="#5-4-1、MVC自动配置原理" class="headerlink" title="5.4.1、MVC自动配置原理"></a>5.4.1、MVC自动配置原理</h5><h6 id="官网阅读"><a href="#官网阅读" class="headerlink" title="官网阅读"></a>官网阅读</h6><p>在进行项目编写前，还需要知道一个东西，就是 <code>SpringBoot</code> 对 <code>SpringMVC</code> 还做了哪些配置，包括如何扩展，如何定制.</p>
<p>只有把这些都搞清楚了，在之后使用才会更加得心应手. 途径一：源码分析，途径二：官方文档！<a href="%EF%BC%9Ahttps://docs.spring.io/spring-boot/docs/2.2.5.RELEASE/reference/htmlsingle/#boot-features-spring-mvc-auto-configuration">地址</a> </p>
<blockquote>
<p>Spring MVC Auto-configuration<br>// Spring Boot为Spring MVC提供了自动配置，它可以很好地与大多数应用程序一起工作。<br>Spring Boot provides auto-configuration for Spring MVC that works well with most applications.<br>// 自动配置在Spring默认设置的基础上添加了以下功能：<br>The auto-configuration adds the following features on top of Spring’s defaults:<br>// 包含视图解析器<br>Inclusion of ContentNegotiatingViewResolver and BeanNameViewResolver beans.<br>// 支持静态资源文件夹的路径，以及webjars<br>Support for serving static resources, including support for WebJars<br>// 自动注册了Converter：<br>// 转换器，这就是我们网页提交数据到后台自动封装成为对象的东西，比如把”1”字符串自动转换为int类型<br>// Formatter：【格式化器，比如页面给我们了一个2019-8-10，它会给我们自动格式化为Date对象】<br>Automatic registration of Converter, GenericConverter, and Formatter beans.<br>// HttpMessageConverters<br>// SpringMVC用来转换Http请求和响应的的，比如我们要把一个User对象转换为JSON字符串，可以去看官网文档解释；<br>Support for HttpMessageConverters (covered later in this document).<br>// 定义错误代码生成规则的<br>Automatic registration of MessageCodesResolver (covered later in this document).<br>// 首页定制<br>Static index.html support.<br>// 图标定制<br>Custom Favicon support (covered later in this document).<br>// 初始化数据绑定器：帮我们把请求数据绑定到JavaBean中！<br>Automatic use of a ConfigurableWebBindingInitializer bean (covered later in this document).</p>
<p>/*<br>如果您希望保留Spring Boot MVC功能，并且希望添加其他MVC配置（拦截器、格式化程序、视图控制器和其他功能），则可以添加自己<br>的@configuration类，类型为webmvcconfiguer，但不得添加@EnableWebMvc。如果希望提供<br>RequestMappingHandlerMapping、RequestMappingHandlerAdapter或ExceptionHandlerExceptionResolver的自定义<br>实例，则可以声明WebMVCregistrationAdapter实例来提供此类组件。<br>*/<br>If you want to keep Spring Boot MVC features and you want to add additional MVC configuration<br>(interceptors, formatters, view controllers, and other features), you can add your own<br>@Configuration class of type WebMvcConfigurer but without @EnableWebMvc. If you wish to provide<br>custom instances of RequestMappingHandlerMapping, RequestMappingHandlerAdapter, or<br>ExceptionHandlerExceptionResolver, you can declare a WebMvcRegistrationsAdapter instance to provide such components.</p>
<p>// 如果您想完全控制Spring MVC，可以添加自己的@Configuration，并用@EnableWebMvc进行注释。<br>If you want to take complete control of Spring MVC, you can add your own @Configuration annotated with @EnableWebMvc.</p>
</blockquote>
<p>仔细对照，看一下它怎么实现的，它告诉我们SpringBoot已经帮我们自动配置好了SpringMVC，然后自动配置了哪些东西呢？</p>
<h6 id="ContentNegotiatingViewResolver-内容协商视图解析器"><a href="#ContentNegotiatingViewResolver-内容协商视图解析器" class="headerlink" title="ContentNegotiatingViewResolver 内容协商视图解析器"></a><strong>ContentNegotiatingViewResolver 内容协商视图解析器</strong></h6><p>==<strong>注:</strong> 如果想要看更透彻的源码 需要降低 <code>SpringBoot</code>  的版本==</p>
<p>自动配置了 <code>ViewResolver</code>，就是我们之前学习的 <code>SpringMVC</code> 的视图解析器；</p>
<p>即根据方法的返回值取得视图对象 <code>(View)</code>，然后由视图对象决定如何渲染(转发, 重定向).  进入内部看这里的源码：可以找到 <code>WebMvcAutoConfiguration</code> ， 然后搜索 <code>ContentNegotiatingViewResolver</code>。找到如下方法！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(ViewResolver.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(name = &quot;viewResolver&quot;, value = ContentNegotiatingViewResolver.class)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ContentNegotiatingViewResolver <span class="title">viewResolver</span><span class="params">(BeanFactory beanFactory)</span> </span>&#123;</span><br><span class="line">   ContentNegotiatingViewResolver resolver = <span class="keyword">new</span> ContentNegotiatingViewResolver();</span><br><span class="line">   resolver.setContentNegotiationManager(beanFactory.getBean(ContentNegotiationManager.class));    <span class="comment">// ContentNegotiatingViewResolver使用所有其他视图解析器来定位视图，因此它应该具有较高的优先级   </span></span><br><span class="line">   resolver.setOrder(Ordered.HIGHEST_PRECEDENCE);</span><br><span class="line">   <span class="keyword">return</span> resolver;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>进入 <code>resolver</code> 类可以找到对应解析视图的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span> <span class="comment">// 注解说明：@Nullable 即参数可为null</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> View <span class="title">resolveViewName</span><span class="params">(String viewName, Locale locale)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      RequestAttributes attrs = RequestContextHolder.getRequestAttributes();</span><br><span class="line">      Assert.state(attrs <span class="keyword">instanceof</span> ServletRequestAttributes, <span class="string">&quot;No current ServletRequestAttributes&quot;</span>);</span><br><span class="line">      List&lt;MediaType&gt; requestedMediaTypes = <span class="keyword">this</span>.getMediaTypes(((ServletRequestAttributes) attrs).getRequest());</span><br><span class="line">      <span class="keyword">if</span> (requestedMediaTypes != <span class="keyword">null</span>) &#123;        <span class="comment">// 获取候选的视图对象        </span></span><br><span class="line">         List&lt;View&gt; candidateViews = <span class="keyword">this</span>.getCandidateViews(viewName, locale, requestedMediaTypes);</span><br><span class="line">         <span class="comment">// 选择一个最适合的视图对象，然后把这个对象返回        </span></span><br><span class="line">         View bestView = <span class="keyword">this</span>.getBestView(candidateViews, requestedMediaTypes, attrs);</span><br><span class="line">         <span class="keyword">if</span> (bestView != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> bestView;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;    <span class="comment">// .....</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>可以看到在 <code>resolveViewName</code> 方法中首先判断是否有用户自己定义的视图对象, 如果有就调用 <code>getBestView</code> 方法去调用<code>getCandidateViews</code> 得到 <code>List&lt;&gt;</code> 中获取的候选视图进行选择, 得到一个 <code>bestView</code> </p>
<p>继续点进去看 <code>getCandidateViews</code> 是怎么获得候选的视图的呢</p>
<p><code>getCandidateViews</code> 中看到他是把所有的视图解析器拿来，进行 <code>while</code> 循环，挨个解析</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Iterator var5 = <span class="keyword">this</span>.viewResolvers.iterator();</span><br></pre></td></tr></table></figure>

<p>所以得出结论：<strong>ContentNegotiatingViewResolver 这个视图解析器就是用来组合所有的视图解析器的</strong></p>
<p>再去研究下他的组合逻辑，看到有个属性viewResolvers，看看它是在哪里进行赋值的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initServletContext</span><span class="params">(ServletContext servletContext)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// 这里它是从beanFactory工具中获取容器中的所有视图解析器    </span></span><br><span class="line">      <span class="comment">// ViewRescolver.class 把所有的视图解析器来组合的    </span></span><br><span class="line">      Collection&lt;ViewResolver&gt; matchingBeans = BeanFactoryUtils.beansOfTypeIncludingAncestors(<span class="keyword">this</span>.obtainApplicationContext(), ViewResolver.class).values();</span><br><span class="line">      ViewResolver viewResolver;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.viewResolvers == <span class="keyword">null</span>) &#123;</span><br><span class="line">         <span class="keyword">this</span>.viewResolvers = <span class="keyword">new</span> ArrayList(matchingBeans.size());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// ...............</span></span><br><span class="line">   &#125;</span><br><span class="line">      </span><br></pre></td></tr></table></figure>

<p>既然它是在容器中去找视图解析器，是否可以猜想，能够去实现一个视图解析器了呢？</p>
<p>可以手动给容器中去添加一个视图解析器；这个类就会帮我们自动的将它组合进来；<strong>下面即可以实现一下</strong></p>
<ul>
<li>在主程序中去写一个视图解析器来试试 </li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="comment">//放到bean中</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ViewResolver <span class="title">myViewResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> MyViewResolver();</span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line"><span class="comment">//我们写一个静态内部类，视图解析器就需要实现ViewResolver接口</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyViewResolver</span> <span class="keyword">implements</span> <span class="title">ViewResolver</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> View <span class="title">resolveViewName</span><span class="params">(String s, Locale locale)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>

<p><strong>这里更推荐将静态内部类拆分为一个独立的类 然后再单独写一个配置类用来返回自定义的配置类</strong></p>
<ul>
<li>怎么看自定义实现的视图解析器有没有起作用呢？</li>
</ul>
<p>给 <code>DispatcherServlet</code> 中的 <code>doDispatch</code> 方法 加个断点进行调试一下，因为所有的请求都会走到这个方法中</p>
<p><img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="https://img2020.cnblogs.com/blog/1418974/202003/1418974-20200320135649063-435423503.png" alt="img"></p>
<ul>
<li>启动项目，随后随便访问一个页面，看一下 Debug 信息, 找到 <code>this</code></li>
</ul>
<p>找到视图解析器，看到自定义的视图解析器的就在这里了；</p>
<p><img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="https://img2020.cnblogs.com/blog/1418974/202003/1418974-20200320135721808-908348729.png" alt="img"></p>
<h6 id="转换器和格式化器"><a href="#转换器和格式化器" class="headerlink" title="转换器和格式化器"></a>转换器和格式化器</h6><p>在 <code>WebMvcAutoConfiguration</code> 中找到格式化转换器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> FormattingConversionService <span class="title">mvcConversionService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   Format format = <span class="keyword">this</span>.mvcProperties.getFormat();</span><br><span class="line">   <span class="comment">// 拿到配置文件中的格式化规则    </span></span><br><span class="line">   WebConversionService conversionService = <span class="keyword">new</span> WebConversionService((<span class="keyword">new</span> DateTimeFormatters()).</span><br><span class="line">           dateFormat(format.getDate()).timeFormat(format.getTime()).</span><br><span class="line">           dateTimeFormat(format.getDateTime()));</span><br><span class="line">   <span class="keyword">this</span>.addFormatters(conversionService);</span><br><span class="line">   <span class="keyword">return</span> conversionService;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>点击进 <code>format.getXXX()</code> 中如果是新版本就会发现里面有默认属性但是具体是什么并不知道, 猜测是封装起来,  并通过 绑定配置文件在容器中进行初始化</p>
<p>如果是老版本就会有下面的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getDateFormat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">this</span>.dateFormat;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*** Date format to use. For instance, `dd/MM/yyyy`. 默认的 */</span></span><br><span class="line"><span class="keyword">private</span> String dateFormat;</span><br></pre></td></tr></table></figure>

<p>可以看到在 <code>Properties</code> 或 <code>yaml</code> 文件中，可以自动配置它！</p>
<p>如果配置了自定义的格式化方式，就会注册到 <code>Bean</code> 中生效, 就可以在配置文件中配置日期格式化的规则：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">format:</span></span><br><span class="line">      <span class="attr">date-time:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDate</span><span class="params">(String date)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.date = date;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>其余的就不一一举例, 可以自行去了解</strong></p>
<h6 id="修改SpringBoot的默认配置"><a href="#修改SpringBoot的默认配置" class="headerlink" title="修改SpringBoot的默认配置"></a>修改SpringBoot的默认配置</h6><p>这么多的自动配置，原理都是一样的，通过 <code>WebMVC</code> 的自动配置原理分析，需要学会一种学习方式，通过源码探究，得出结论；这个结论一定是属于自己的，而且一通百通。</p>
<p><code>SpringBoot</code> 的底层，大量用到了这些设计细节思想，所以，需要多阅读源码! 得出结论；</p>
<p><strong><code>SpringBoot</code> 在自动配置很多组件的时候，先看容器中有没有用户自己配置的 (如果用户自己配置 <code>@bean</code> )，如果有就用用户配置的，如果没有就用自动配置的；</strong></p>
<p><strong>如果有些组件可以存在多个，比如我们的视图解析器，就将用户配置的和自己默认的组合起来！</strong></p>
<h6 id="扩展使用SpringMVC"><a href="#扩展使用SpringMVC" class="headerlink" title="扩展使用SpringMVC"></a><strong>扩展使用SpringMVC</strong></h6><p>官方文档如下：</p>
<blockquote>
<p>If you want to keep Spring Boot MVC features and you want to add additional MVC configuration (interceptors, formatters, view controllers, and other features), you can add your own @Configuration class of type WebMvcConfigurer but without @EnableWebMvc. If you wish to provide custom instances of RequestMappingHandlerMapping, RequestMappingHandlerAdapter, or ExceptionHandlerExceptionResolver, you can declare a WebMvcRegistrationsAdapter instance to provide such components.</p>
</blockquote>
<p>用户要做的就是编写一个 <code>@Configuration</code> 注解类，并且类型要为 <code>WebMvcConfigurer</code> ，并且不能标注<code>@EnableWebMvc</code> 注解；</p>
<p>下面去自定义一个；新建一个包叫config，写一个类 <code>MyMvcConfig</code>；</p>
<p>​    <img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="C:\Users\雷神\AppData\Roaming\Typora\typora-user-images\image-20211024165818485.png" alt="image-20211024165818485"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//全面扩展 springMVC</span><br><span class="line">// 如果要扩展 SpringMVC 官方建议这样去做</span><br><span class="line">@Configuration</span><br><span class="line">//@EnableWebMvc </span><br><span class="line">// 其导入了一个类 DelegatingWebMvcConfiguration 从容器中获取所有的 webMvcConfig:</span><br><span class="line">public class MyMvcConfig implements WebMvcConfigurer &#123;</span><br><span class="line">   public interface ViewResolver //实现了视图解析器接口的类 就可以把它看作视图解析器    </span><br><span class="line">   // 视图跳转    </span><br><span class="line">   @Override</span><br><span class="line">   public void addViewControllers(ViewControllerRegistry registry) &#123;</span><br><span class="line">      registry.addViewController(&quot;/Cu1&quot;).setViewName(&quot;test&quot;);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试请自行启动 <code>SpringBoot</code> 项目进行测试 最后发现自定义视图解析器中访问 <code>/Cu1</code> 后跳转到 <code>test.html</code></p>
<p><strong>所以说，要扩展SpringMVC，官方就推荐这么去使用，既保SpringBoot留所有的自动配置，也能使用用户扩展的配置！</strong></p>
<p><strong>可以去分析一下原理：</strong></p>
<ol>
<li><p><code>WebMvcAutoConfiguration </code>是 <code>SpringMVC</code> 的自动配置类，里面有一个类<code>WebMvcAutoConfigurationAdapter</code></p>
</li>
<li><p>这个类上有一个注解，在做其他自动配置时会导入：<code>@Import(EnableWebMvcConfiguration.class)</code></p>
</li>
<li><p>点进 <code>EnableWebMvcConfiguration</code> 这个类，它继承了一个父类：<code>DelegatingWebMvcConfiguration</code> , 这个父类中有这样一段代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelegatingWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurationSupport</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> WebMvcConfigurerComposite configurers = <span class="keyword">new</span> WebMvcConfigurerComposite();</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 从容器中获取所有的webmvcConfigurer    </span></span><br><span class="line">   <span class="meta">@Autowired(required = false)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConfigurers</span><span class="params">(List&lt;WebMvcConfigurer&gt; configurers)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!CollectionUtils.isEmpty(configurers)) &#123;</span><br><span class="line">         <span class="keyword">this</span>.configurers.addWebMvcConfigurers(configurers);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>可以在这个类中去寻找一个刚才设置的 <code>viewController</code> 当做参考，发现它调用了一个</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;    <span class="keyword">this</span>.configurers.addViewControllers(registry);&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>点击进入 <code>addViewControllers</code> 方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">  Iterator var2 = <span class="keyword">this</span>.delegates.iterator();</span><br><span class="line">  <span class="keyword">while</span> (var2.hasNext()) &#123;</span><br><span class="line"><span class="comment">// 将所有的WebMvcConfigurer相关配置来一起调用！包括我们自己配置的和Spring给我们配置的     </span></span><br><span class="line">      WebMvcConfigurer delegate = (WebMvcConfigurer) var2.next();</span><br><span class="line">      delegate.addViewControllers(registry);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>所以得出结论：所有的WebMvcConfiguration都会被作用，不止Spring自己的配置类，用户自己的配置类当然也会被调用；</strong></p>
</li>
</ol>
<h6 id="全面接管SpringMVC"><a href="#全面接管SpringMVC" class="headerlink" title="全面接管SpringMVC"></a>全面接管SpringMVC</h6><p>官方文档：</p>
<blockquote>
<p>If you want to take complete control of Spring MVC<br>you can add your own @Configuration annotated with @EnableWebMvc.</p>
</blockquote>
<p>全面接管即：<code>SpringBoot对SpringMVC</code> 的自动配置不需要了，所有都是用户自己去配置！</p>
<p>只需在我们的配置类中要加一个 <code>@EnableWebMvc</code> 。</p>
<p>如果用户选择全面接管了 <code>SpringMVC</code> 了，那么之前 <code>SpringBoot</code> 默认配置的静态资源映射一定会无效，我们可以去测试一下；</p>
<p><strong>当然，在开发中，不推荐使用全面接管SpringMVC</strong></p>
<p>思考问题？为什么加了一个注解，自动配置就失效了！继续看下源码：</p>
<ol>
<li><p>进入<code>@EnableWebMvc</code> 发现它是导入了一个类，可以继续进去看</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(&#123;DelegatingWebMvcConfiguration.class&#125;)</span><span class="keyword">public</span> <span class="meta">@interface</span> EnableWebMvc &#123;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>进入 <code>DelegatingWebMvcConfiguration</code> 类 发现它继承了一个父类 <code>WebMvcConfigurationSupport</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelegatingWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurationSupport</span> </span>&#123;  <span class="comment">// ......&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p>现在来回顾一下Webmvc自动配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class&#125;)</span></span><br><span class="line"><span class="comment">// 这个注解的意思就是：容器中没有这个组件的时候，这个自动配置类才生效</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(&#123;DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class, ValidationAutoConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcAutoConfiguration</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>总结一句话：<code>@EnableWebMvc</code> 将 <code>WebMvcConfigurationSupport</code> 组件导入进来了, 导致了 SpringMVC 的配置失效</p>
<p>而导入的 <code>WebMvcConfigurationSupport</code> 只是 <code>SpringMVC</code> 最基本的功能！</p>
<p>==<strong>在SpringBoot中会有非常多的扩展配置，只要看见了这个，就应该多留心注意~</strong>==</p>
</li>
</ol>
<h2 id="6、数据库"><a href="#6、数据库" class="headerlink" title="6、数据库"></a>6、数据库</h2><h3 id="6-1、SpringData简介"><a href="#6-1、SpringData简介" class="headerlink" title="6.1、SpringData简介"></a>6.1、SpringData简介</h3><p>对于数据访问层，无论是 SQL(关系型数据库) 还是 NOSQL(非关系型数据库)，Spring Boot 底层都是采用 Spring Data 的方式进行统一处理。</p>
<p>Spring Boot 底层都是采用 Spring Data 的方式进行统一处理各种数据库，Spring Data 也是 Spring 中与 Spring Boot、Spring Cloud 等齐名的知名项目。</p>
<p><a target="_blank" rel="noopener" href="https://spring.io/projects/spring-data">Sping Data 官网</a></p>
<p>数据库相关的启动器 ：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.2.5.RELEASE/reference/htmlsingle/#using-boot-starter">可以参考官方文档</a></p>
<h3 id="6-2、整合JDBC-建议快速看过即可"><a href="#6-2、整合JDBC-建议快速看过即可" class="headerlink" title="6.2、整合JDBC (建议快速看过即可)"></a>6.2、整合JDBC (建议快速看过即可)</h3><h4 id="创建测试项目测试数据源"><a href="#创建测试项目测试数据源" class="headerlink" title="创建测试项目测试数据源"></a>创建测试项目测试数据源</h4><ol>
<li><p>新建一个项目测试：springboot-data-jdbc ; 引入相应的模块！基础模块</p>
<p><img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="https://img2020.cnblogs.com/i-beta/1418974/202003/1418974-20200314125500009-472778612.png" alt="img"></p>
</li>
<li><p><strong>编写yaml配置文件连接数据库；</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="comment">#?serverTimezone=UTC解决时区的报错(如果不是 mysql 8.0+ 的话不需要设置时区)</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/springboot?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>配置完后，就可以直接去使用了，因为 <code>SpringBoot</code> 已经默认进行了自动配置</p>
<p><strong>测试类测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTestclass</span></span><br><span class="line">SpringBoot04DataApplicationTests &#123;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   DataSource dataSource;</span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span> <span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">      <span class="comment">//查看默认数据源        </span></span><br><span class="line">      System.out.println(dataSource.getClass());</span><br><span class="line">      <span class="comment">//获取数据源class com.zaxxer.hikari.HikariDataSource 默认的数据源       </span></span><br><span class="line">      Connection connection = dataSource.getConnection();</span><br><span class="line">      <span class="comment">// xxxx Template: springBoot 已经配置好的模板 Bean 拿来即用        </span></span><br><span class="line">      <span class="comment">// 关闭连接         </span></span><br><span class="line">      connection.close();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>结果</strong>：可以看到默认配置的数据源为 : <code>class com.zaxxer.hikari.HikariDataSource </code>， 并不需要手动配置</p>
<p>进行全局搜索, 找到数据源的所有自动配置都在: <code>DataSourceAutoConfiguration</code> 文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(&#123;Hikari.class, Tomcat.class, Dbcp2.class, Generic.class, DataSourceJmxConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PooledDataSourceConfiguration</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="title">PooledDataSourceConfiguration</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>可以使用 spring.datasource.type 指定自定义的数据源类型，值为 要使用的连接池实现的完全限定名。</strong></p>
<p><code>SpringBoot</code> 也提供了数据库连接的类 <code>JDBCTemplate</code></p>
<h4 id="JDBCTemplate"><a href="#JDBCTemplate" class="headerlink" title="JDBCTemplate"></a>JDBCTemplate</h4><ol>
<li><p>有了数据源 <code>(com.zaxxer.hikari.HikariDataSource)</code> ，可以拿到数据库连接 <code>(java.sql.Connection)</code> ，有了连接，就可以使用原生的 JDBC 语句来操作数据库；</p>
</li>
<li><p>即使不使用第三方第数据库操作框架，如 <code>MyBatis</code> 等，<code>Spring</code> 本身也对原生的 <code>JDBC</code> 做了轻量级的封装，即 <code>JdbcTemplate</code></p>
</li>
<li><p>数据库操作的所有 <code>CRUD</code> 方法都在 <code>JdbcTemplate</code> 中。</p>
</li>
<li><p><code>Spring Boot</code> 不仅提供了默认的数据源，同时默认已经配置好了<code> JdbcTemplate</code> 放在了容器中，用户只需自己注入即可使用</p>
</li>
<li><p><code>JdbcTemplate</code> 的自动配置是依赖 <code>org.springframework.boot.autoconfigure.jdbc</code> 包下的<code> JdbcTemplateConfiguration</code> 类</p>
<p><strong>JdbcTemplate主要提供以下几类方法：</strong></p>
<ul>
<li>execute方法：可以用于执行任何SQL语句，一般用于执行DDL语句；</li>
<li>update方法及batchUpdate方法：update方法用于执行新增、修改、删除等语句；batchUpdate方法用于执行批处理相关语句；</li>
<li>query方法及queryForXXX方法：用于执行查询相关语句；</li>
<li>call方法：用于执行存储过程、函数相关语句。</li>
</ul>
</li>
</ol>
<p> <strong>测试</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/jdbc&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcController</span> </span>&#123;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Spring Boot 默认提供了数据源，默认提供了 org.springframework.jdbc.core.JdbcTemplate</span></span><br><span class="line"><span class="comment">    * * JdbcTemplate 中会自己注入数据源，用于简化 JDBC操作</span></span><br><span class="line"><span class="comment">    * * 还能避免一些常见的错误,使用起来也不用再自己来关闭数据库连接</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//查询employee表中所有数据    </span></span><br><span class="line"><span class="comment">// List 中的1个 Map 对应数据库的 1行数据    </span></span><br><span class="line"><span class="comment">// Map 中的 key 对应数据库的字段名，value 对应数据库的字段值    </span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; userList() &#123;</span><br><span class="line">      String sql = <span class="string">&quot;select * from employee&quot;</span>;</span><br><span class="line">      List&lt;Map&lt;String, Object&gt;&gt; maps = jdbcTemplate.queryForList(sql);</span><br><span class="line">      <span class="keyword">return</span> maps;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//新增一个用户    </span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/add&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">addUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">//插入语句，注意时间问题        </span></span><br><span class="line">      String sql = <span class="string">&quot;insert into employee(last_name, email,gender,department,birth)&quot;</span> + <span class="string">&quot; values (&#x27;狂神说&#x27;,&#x27;24736743@qq.com&#x27;,1,101,&#x27;&quot;</span> + <span class="keyword">new</span> Date().toLocaleString() + <span class="string">&quot;&#x27;)&quot;</span>;</span><br><span class="line">      jdbcTemplate.update(sql);</span><br><span class="line">      <span class="comment">//查询        </span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;addOk&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//修改用户信息    </span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/update/&#123;id&#125;&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">updateUser</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// 插入语句        </span></span><br><span class="line">      <span class="comment">// String sql = &quot;update employee set last_name=?,email=? where id=&quot;+id;        </span></span><br><span class="line">      <span class="comment">// 数据        </span></span><br><span class="line">      Object[] objects = <span class="keyword">new</span> Object[<span class="number">2</span>];</span><br><span class="line">      objects[<span class="number">0</span>] = <span class="string">&quot;秦疆&quot;</span>;</span><br><span class="line">      objects[<span class="number">1</span>] = <span class="string">&quot;24736743@sina.com&quot;</span>;</span><br><span class="line">      jdbcTemplate.update(sql, objects);</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;updateOk&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 删除用户    </span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/delete/&#123;id&#125;&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">delUser</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// 插入语句        </span></span><br><span class="line">      String sql = <span class="string">&quot;delete from employee where id=?&quot;</span>;</span><br><span class="line">      jdbcTemplate.update(sql, id);                </span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;deleteOk&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-3、-集成Druid"><a href="#6-3、-集成Druid" class="headerlink" title="6.3、 集成Druid"></a>6.3、 集成Druid</h3><h4 id="Druid简介"><a href="#Druid简介" class="headerlink" title="Druid简介"></a>Druid简介</h4><p><code>Java</code> 程序很大一部分要操作数据库，为了提高性能操作数据库的时候，又不得不使用数据库连接池。</p>
<p><code>Druid</code> 是阿里巴巴开源平台上一个数据库连接池实现，结合了 <code>C3P0、DBCP</code> 等 <code>DB</code> 池的优点，同时加入了<strong>日志监控</strong>。</p>
<p><code>Druid</code> 监控 <code>DB</code> 池连接和 <code>SQL</code> 的执行情况，是针对监控而生的 <code>DB</code> 连接池。</p>
<p><code>Spring Boot 2.0</code> 以上默认使用 <code>Hikari</code> 数据源，可以说 <code>Hikari</code> 与 <code>Driud</code> 都是当前<code>Java Web</code>上最优秀的数据源，讲来重点介绍 <code>Spring Boot</code> 如何集成 <code>Druid</code>数据源，实现数据库监控。<a target="_blank" rel="noopener" href="https://github.com/alibaba/druid/">Github地址</a></p>
<p><strong>com.alibaba.druid.pool.DruidDataSource 基本配置参数如下：</strong></p>
<p><img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="https://img2020.cnblogs.com/i-beta/1418974/202003/1418974-20200315130100616-1363003780.png" alt="img"></p>
<p><img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="https://img2020.cnblogs.com/i-beta/1418974/202003/1418974-20200315130120347-1640632477.png" alt="img"></p>
<p><img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="https://img2020.cnblogs.com/i-beta/1418974/202003/1418974-20200315130155468-660906104.png" alt="img"></p>
<h4 id="配置数据源"><a href="#配置数据源" class="headerlink" title="配置数据源"></a>配置数据源</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--druid 数据源--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>切换数据源  <code>Spring Boot 2.0</code> 以上默认使用 <code>com.zaxxer.hikari.HikariDataSource</code> 数据源，但可以 通过 <code>spring.datasource.type</code> 指定数据源</p>
</li>
<li><p>下面是 <code>Druid</code> 的配置</p>
<p>可以设置数据源连接初始化大小、最大连接数、等待时间、最小连接数 等设置项；可以查看源码</p>
</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> </span><br><span class="line">    <span class="attr">password:</span> </span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://47.100.227.175:3306/School?useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">    <span class="comment"># 切换为 druid 数据源</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">#Spring Boot 默认是不注入这些属性值的，需要自己绑定</span></span><br><span class="line">      <span class="comment">#druid 数据源专有配置</span></span><br><span class="line">    <span class="attr">initialSize:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">minIdle:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">maxActive:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">maxWait:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">timeBetweenEvictionRunsMillis:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">minEvictableIdleTimeMillis:</span> <span class="number">300000</span></span><br><span class="line">    <span class="attr">validationQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">DUAL</span></span><br><span class="line">    <span class="attr">testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">testOnBorrow:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">testOnReturn:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">poolPreparedStatements:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#配置监控统计拦截的filters，stat:监控统计、log4j：日志记录、wall：防御sql注入</span></span><br><span class="line">    <span class="comment">#如果允许时报错  java.lang.ClassNotFoundException: org.apache.log4j.Priority</span></span><br><span class="line">    <span class="comment">#则导入 log4j 依赖即可，Maven 地址：https://mvnrepository.com/artifact/log4j/log4j</span></span><br><span class="line">    <span class="attr">filters:</span> <span class="string">stat,wall,log4j</span></span><br><span class="line">    <span class="attr">maxPoolPreparedStatementPerConnectionSize:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">useGlobalDataSourceStat:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">connectionProperties:</span> <span class="string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span></span><br></pre></td></tr></table></figure>

<h4 id="导入Log4j-的依赖"><a href="#导入Log4j-的依赖" class="headerlink" title="导入Log4j 的依赖"></a>导入Log4j 的依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/log4j/log4j --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>进行了上面的配置之后, 就不再使用 <code>SprinhBoot</code> 提供的默认 <code>Druid</code> 数据源了, 而是想要 <code>SpringBoot</code> 使用自定义配置的数据源, 需要自行利用配置类将数据源 <code>DruidDataSource</code> 组件添加到容器中并绑定属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DruidConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">//使用 Druid 数据源</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">druidDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="配置Druid数据源监控"><a href="#配置Druid数据源监控" class="headerlink" title="配置Druid数据源监控"></a>配置Druid数据源监控</h4><p><code>Druid</code> 数据源具有监控的功能，并提供了一个 web 界面方便用户查看，类似安装 路由器 时，同时也提供了一个默认的 <code>web</code> 页面。</p>
<p>所以第一步需要设置 <code>Druid</code> 的后台管理页面，比如 登录账号、密码 等；配置后台管理；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//后台监控 相当于 web.xml</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    *  因为 SpringBoot 内置了 servlet 容器 所以没有 web.xml 替代方法 ServletRegistrationBean</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">StatViewServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ServletRegistrationBean&lt;StatViewServlet&gt; bean = <span class="keyword">new</span> ServletRegistrationBean&lt;&gt;(<span class="keyword">new</span> StatViewServlet(), <span class="string">&quot;/druid/*&quot;</span>);</span><br><span class="line">        HashMap&lt;String, String&gt; initParameters = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="comment">//添加配置</span></span><br><span class="line">        <span class="comment">//登录的 key 是固定的</span></span><br><span class="line">        initParameters.put(<span class="string">&quot;loginUsername&quot;</span>, <span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        initParameters.put(<span class="string">&quot;loginPassword&quot;</span>, <span class="string">&quot;35157210&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * 允许谁可以访问</span></span><br><span class="line"><span class="comment">        * 若为空 则所有人都可以访问</span></span><br><span class="line"><span class="comment">        * 可以填具体的人</span></span><br><span class="line"><span class="comment">        * */</span></span><br><span class="line">        initParameters.put(<span class="string">&quot;allow&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * 禁止谁可以访问</span></span><br><span class="line"><span class="comment">        * */</span></span><br><span class="line">        <span class="comment">//initParameters.put(&quot;用户名&quot;, &quot;用户 Ip&quot;);</span></span><br><span class="line">        <span class="comment">//后台有人需要登录 账号密码配置</span></span><br><span class="line">        bean.setInitParameters(initParameters); <span class="comment">//初始化参数</span></span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//filter</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">webStarFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        FilterRegistrationBean&lt;Filter&gt; bean = <span class="keyword">new</span> FilterRegistrationBean&lt;&gt;();</span><br><span class="line">        bean.setFilter(<span class="keyword">new</span> WebStatFilter());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//可以过滤哪些请求</span></span><br><span class="line">        HashMap&lt;String, String&gt; initParameters = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//这些东西不进行统计</span></span><br><span class="line">        initParameters.put(<span class="string">&quot;exclusions&quot;</span>, <span class="string">&quot;*.js, *.css, /druid/*&quot;</span>);</span><br><span class="line"></span><br><span class="line">        bean.setInitParameters(initParameters);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>配置完毕后，我们可以选择访问 ：<a target="_blank" rel="noopener" href="http://localhost:8080/druid/login.html">http://localhost:8080/druid/login.html</a></p>
<p><img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="C:\Users\雷神\AppData\Roaming\Typora\typora-user-images\image-20211031201739958.png" alt="image-20211031201739958"></p>
<p> 进入之后</p>
<p><img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="C:\Users\雷神\AppData\Roaming\Typora\typora-user-images\image-20211031201813993.png" alt="image-20211031201813993"></p>
<h4 id="配置-Druid-web-监控-filter-过滤器"><a href="#配置-Druid-web-监控-filter-过滤器" class="headerlink" title="配置 Druid web 监控 filter 过滤器"></a><strong>配置 Druid web 监控 filter 过滤器</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//filter    @Bean    public FilterRegistrationBean webStarFilter() &#123;        FilterRegistrationBean&lt;Filter&gt; bean = new FilterRegistrationBean&lt;&gt;();        bean.setFilter(new WebStatFilter());        //可以过滤哪些请求        HashMap&lt;String, String&gt; initParameters = new HashMap&lt;&gt;();        //这些东西不进行统计        initParameters.put(&quot;exclusions&quot;, &quot;*.js, *.css, /druid/*&quot;);        bean.setInitParameters(initParameters);        return bean;    &#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>平时在工作中，按需求进行配置即可，主要用作监控！</strong></p>
<p>完整代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">@Configurationpublic</span><br><span class="line">class DruidConfig &#123;</span><br><span class="line">    //使用 Druid 数据源</span><br><span class="line">    @ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span><br><span class="line">    @Bean</span><br><span class="line">    public DataSource druidDataSource() &#123;</span><br><span class="line">        return new DruidDataSource();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //后台监控 相当于 web.xml</span><br><span class="line">    /**</span><br><span class="line">     * 因为 SpringBoot 内置了 servlet 容器 所以没有 web.xml 替代方法 ServletRegistrationBean</span><br><span class="line">     * */</span><br><span class="line">    @Bean</span><br><span class="line">    public ServletRegistrationBean StatViewServlet() &#123;</span><br><span class="line">        ServletRegistrationBean&lt;StatViewServlet&gt; bean = new ServletRegistrationBean&lt;&gt;(new StatViewServlet(), &quot;/druid/*&quot;);</span><br><span class="line">        HashMap&lt;String, String&gt; initParameters = new HashMap&lt;&gt;();</span><br><span class="line">        //添加配置</span><br><span class="line">        // 登录的 key 是固定的</span><br><span class="line">        initParameters.put(&quot;loginUsername&quot;, &quot;admin&quot;);</span><br><span class="line">        initParameters.put(&quot;loginPassword&quot;, &quot;35157210&quot;);</span><br><span class="line">        /** 允许谁可以访问</span><br><span class="line">         * 若为空 则所有人都可以访问       * 可以填具体的人        </span><br><span class="line">         **/</span><br><span class="line">        initParameters.put(&quot;allow&quot;, &quot;&quot;);</span><br><span class="line">        /** </span><br><span class="line">         * 禁止谁可以访问</span><br><span class="line">         **/</span><br><span class="line">        initParameters.put(&quot;用户名&quot;, &quot;用户 Ip&quot;);</span><br><span class="line">        //后台有人需要登录 账号密码配置        </span><br><span class="line">        bean.setInitParameters(initParameters);</span><br><span class="line">        //初始化参数        </span><br><span class="line">        return bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //filter    </span><br><span class="line">    @Bean</span><br><span class="line">    public FilterRegistrationBean webStarFilter() &#123;</span><br><span class="line">        FilterRegistrationBean&lt;Filter&gt; bean = new FilterRegistrationBean&lt;&gt;();</span><br><span class="line">        bean.setFilter(new WebStatFilter());</span><br><span class="line">        //可以过滤哪些请求     </span><br><span class="line">        HashMap&lt;String, String&gt; initParameters = new HashMap&lt;&gt;();</span><br><span class="line">        //这些东西不进行统计        </span><br><span class="line">        initParameters.put(&quot;exclusions&quot;, &quot;*.js, *.css, /druid/*&quot;);</span><br><span class="line">        bean.setInitParameters(initParameters);</span><br><span class="line">        return bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="6-4、整合-MyBatis"><a href="#6-4、整合-MyBatis" class="headerlink" title="6.4、整合 MyBatis"></a>6.4、整合 MyBatis</h3><p><a target="_blank" rel="noopener" href="http://mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/">官方文档</a></p>
<p><a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/org.mybatis.spring.boot/mybatis-spring-boot-starter/2.1.1">Maven仓库地址</a></p>
<h4 id="整合测试"><a href="#整合测试" class="headerlink" title="整合测试"></a>整合测试</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mybatis 整合 mybatis-spring-boot-starter 非 SpringBoot 官方--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis.spring.boot/mybatis-spring-boot-starter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>    				    	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="配置数据库连接信息（不变）"><a href="#配置数据库连接信息（不变）" class="headerlink" title="配置数据库连接信息（不变）"></a>配置数据库连接信息（不变）</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 47.100.227.175</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">  <span class="attr">username:</span></span><br><span class="line">  <span class="attr">password:</span></span><br><span class="line">  <span class="attr">url:</span></span><br><span class="line">    <span class="attr">jdbc:</span> <span class="string">mysql://47.100.227.175:3306/School?useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span>    <span class="comment"># 配置 druid 数据源    </span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span>      </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="comment">#Spring Boot    #druid</span></span><br><span class="line">  <span class="attr">initialSize:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">minIdle:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">maxActive:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">maxWait:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">timeBetweenEvictionRunsMillis:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">minEvictableIdleTimeMillis:</span> <span class="number">300000</span></span><br><span class="line">    <span class="attr">validationQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">DUAL</span></span><br><span class="line">    <span class="attr">testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">testOnBorrow:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">testOnReturn:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">poolPreparedStatements:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">filters:</span> <span class="string">stat,wall,log4j</span></span><br><span class="line">    <span class="attr">maxPoolPreparedStatementPerConnectionSize:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">useGlobalDataSourceStat:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">connectionProperties:</span> <span class="string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500#</span> <span class="string">配置</span></span><br><span class="line">    <span class="attr">MyBatismybatis:</span></span><br><span class="line">      <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span></span><br><span class="line">    <span class="comment"># type-aliases-package: com.cu1.pojo 扫描包</span></span><br></pre></td></tr></table></figure>

<p><strong>测试数据库是否连接成功！</strong></p>
<h4 id="创建实体类，导入-Lombok"><a href="#创建实体类，导入-Lombok" class="headerlink" title="创建实体类，导入 Lombok"></a><strong>创建实体类，导入 Lombok</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructorpublic</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">   <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="创建mapper目录以及对应的-Mapper-接口"><a href="#创建mapper目录以及对应的-Mapper-接口" class="headerlink" title="创建mapper目录以及对应的 Mapper 接口"></a><strong>创建mapper目录以及对应的 Mapper 接口</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这个注解表示了这是一个 MyBatis 的 Mapper 类</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="meta">@Repository</span><span class="comment">//这个不需要 只需要 mapper 就可以</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">queryUserList</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">User <span class="title">queryUserById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">addUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteUser</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="对应的Mapper映射文件"><a href="#对应的Mapper映射文件" class="headerlink" title="对应的Mapper映射文件"></a><strong>对应的Mapper映射文件</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace=&quot;com.cu1.mapper.UserMapper&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=&quot;queryUserList&quot; resultType=&quot;com.cu1.pojo.User&quot; useCache=&quot;true&quot;&gt;</span><br><span class="line">        select * from School.User;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=&quot;queryUserById&quot; resultType=&quot;com.cu1.pojo.User&quot;&gt;</span><br><span class="line">        select * from School.User where id = #&#123;id&#125;;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;insert id=&quot;addUser&quot; parameterType=&quot;com.cu1.pojo.User&quot;&gt;</span><br><span class="line">        insert into School.User (id, name) values (#&#123;id&#125;, #&#123;name&#125;);</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;update id=&quot;updateUser&quot; parameterType=&quot;com.cu1.pojo.User&quot;&gt;</span><br><span class="line">        update School.User set name = #&#123;name&#125; where id = #&#123;id&#125;;</span><br><span class="line">    &lt;/update&gt;</span><br><span class="line"></span><br><span class="line">    &lt;delete id=&quot;deleteUser&quot; parameterType=&quot;int&quot;&gt;</span><br><span class="line">        delete from School.User where id = #&#123;id&#125;;</span><br><span class="line">    &lt;/delete&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

<p>**然后设置 <code>mapper.xml</code> 的路径 **</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置 MyBatis</span></span><br><span class="line"><span class="attr">mybatis: mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span></span><br><span class="line"><span class="comment"># type-aliases-package: com.cu1.pojo 扫描包</span></span><br></pre></td></tr></table></figure>

<p>这样就把 <code>.xml</code> 配置文件加入到 <code>MyBatis</code> 中</p>
<p>如果不想配置可以选择在</p>
<p>​    <img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="C:\Users\雷神\AppData\Roaming\Typora\typora-user-images\image-20211101220446773.png" alt="image-20211101220446773"></p>
<p>中加入 <code>MyBatis</code> 扫描包的注解 但是建议把配置文件放到 <code>resources</code> 中统一配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">//扫描某个包下的 mapper 类似于之前的扫描包</span></span><br><span class="line"><span class="comment">//@MapperScan(&quot;com.cu1.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBoot05MyBatisApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringBoot05MyBatisApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="编写-Controller-进行测试！"><a href="#编写-Controller-进行测试！" class="headerlink" title="编写 Controller 进行测试！"></a><strong>编写 Controller 进行测试！</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/queryUserList&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">queryUserList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; users = userMapper.queryUserList();</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="7、SpringSecurity"><a href="#7、SpringSecurity" class="headerlink" title="7、SpringSecurity"></a>7、SpringSecurity</h2><h3 id="安全简介"><a href="#安全简介" class="headerlink" title="安全简介"></a>安全简介</h3><ul>
<li><p>在 Web 开发中，安全一直是非常重要的一个方面。安全虽然属于应用的非功能性需求，但是应该在应用开发的初期就考虑进来。如果在应用开发的后期才考虑安全的问题，就可能陷入一个两难的境地：一方面，应用存在严重的安全漏洞，无法满足用户的要求，并可能造成用户的隐私数据被攻击者窃取；另一方面，应用的基本架构已经确定，要修复安全漏洞，可能需要对系统的架构做出比较重大的调整，因而需要更多的开发时间，影响应用的发布进程。因此，从应用开发的第一天就应该把安全相关的因素考虑进来，并在整个应用的开发过程中。</p>
</li>
<li><p>存在比较有名的：<code>Shiro</code>，<code>Spring Security</code> ！</p>
</li>
<li><p>这里需要阐述一下的是，每一个框架的出现都是为了解决某一问题而产生了，那么 <code>Spring Security</code> 框架的出现是为了解决什么问题呢？</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/5.5.2-SNAPSHOT/reference/html5/">Spring Security官网地址</a></p>
</li>
</ul>
<blockquote>
<p>Spring Security is a powerful and highly customizable authentication and access-control framework. It is the de-facto standard for securing Spring-based applications.</p>
<p>Spring Security is a framework that focuses on providing both authentication and authorization to Java applications. Like all Spring projects, the real power of Spring Security is found in how easily it can be extended to meet custom requirement</p>
</blockquote>
<p><code>Spring Security</code> 是一个功能强大且高度可定制的身份验证和访问控制框架。它实际上是保护基于 <code>spring</code>的应用程序的标准。</p>
<p><code>Spring Security</code> 是一个框架，侧重于为 <code>Java</code> 应用程序提供身份验证和授权。与所有 <code>Spring</code> 项目一样，<code>Spring</code> 安全性的真正强大之处在于它可以轻松地扩展以满足定制需求</p>
<ul>
<li><p>从官网的介绍中可以知道这是一个 <strong>权限框架</strong>  想我们之前做项目是没有使用框架是怎么控制权限的？对于权限 一般会细分为 ==功能权限，访问权限，和菜单权限==。代码会写的非常的繁琐，冗余。</p>
</li>
<li><p>怎么解决之前写权限代码繁琐，冗余的问题，一些主流框架就应运而生而 <code>Spring Scecurity</code> 就是其中的一种。</p>
</li>
<li><p><strong>Spring 是一个非常流行和成功的 Java 应用开发框架。<code>Spring Security</code> 基于 <code>Spring</code> 框架，提供了一套 Web 应用安全性的完整解决方案。一般来说，Web 应用的安全性包括==用户认证====Authentication==）和==用户授权==（==Authorization==）两个部分。用户认证指的是验证某个用户是否为系统中的合法主体，也就是说用户能否访问该系统。用户认证一般要求用户提供用户名和密码。系统通过校验用户名和密码来完成认证过程。用户授权指的是验证某个用户是否有权限执行某个操作。在一个系统中，不同用户所具有的权限是不同的。比如对一个文件来说，有的用户只能进行读取，而有的用户可以进行修改。一般来说，系统会为不同的用户分配不同的角色，而每个角色则对应一系列的权限。</strong></p>
</li>
<li><p>对于上面提到的两种应用情景，<code>Spring Security</code> 框架都有很好的支持。在用户认证方面，<code>Spring Security</code>框架支持主流的认证方式，包括 <code>HTTP基本认证</code>、<code>HTTP 表单验证</code>、<code>HTTP 摘要认证</code>、<code>OpenID</code> 和 <code>LDAP</code> 等。在用户授权方面，<code>Spring Security</code> 提供了基于角色的访问控制和访问控制列表（<code>Access Control List</code>，<code>ACL</code>），可以对应用中的领域对象进行细粒度的控制。</p>
</li>
</ul>
<h3 id="导入-SpringSecurity"><a href="#导入-SpringSecurity" class="headerlink" title="导入 SpringSecurity"></a>导入 SpringSecurity</h3><p><strong>pom.xml</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!--Thymeleaf 与 security 整合包--&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.thymeleaf.extras/thymeleaf-extras-springsecurity5 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.thymeleaf.extras<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-springsecurity5<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里注意一下 <code>thymeleaf</code> 和 <code>thymeleaf-extras-springsecurity</code> 的版本号问题</p>
<h3 id="认识SpringSecurity"><a href="#认识SpringSecurity" class="headerlink" title="认识SpringSecurity"></a>认识SpringSecurity</h3><ol>
<li>Spring Security 是针对Spring项目的安全框架，也是Spring Boot底层安全模块默认的技术选型，他可以实现强大的Web安全控制，对于安全控制，我们仅需要引入 spring-boot-starter-security 模块，进行少量的配置，即可实现强大的安全管理！</li>
<li>核心的几个类：<ul>
<li><code>WebSecurityConfigurerAdapter</code>自定义Security策略</li>
</ul>
</li>
</ol>
<ul>
<li><code>AuthenticationManagerBuilder</code>：自定义认证策略</li>
<li><code>@EnableWebSecurity</code>：开启WebSecurity模式 【<a target="_blank" rel="noopener" href="https://github.com/Enablexxx">@Enablexxx</a>开启某个功能】</li>
</ul>
<ol>
<li><p>Spring Security的两个主要目标是 “认证” 和 “授权”（访问控制）。</p>
<p><strong>“认证”（Authentication）</strong></p>
<p>身份验证是关于验证您的凭据，如用户名/用户ID和密码，以验证您的身份。</p>
<p>身份验证通常通过用户名和密码完成，有时与身份验证因素结合使用。</p>
<p><strong>“授权” （Authorization）</strong></p>
<p>授权发生在系统成功验证您的身份后，最终会授予您访问资源（如信息，文件，数据库，资金，位置，几乎任何内容）的完全权限。</p>
<p>这个概念是通用的，而不是只在Spring Security 中存在。</p>
</li>
</ol>
<h3 id="编写-Spring-Security-配置类"><a href="#编写-Spring-Security-配置类" class="headerlink" title="编写 Spring Security 配置类"></a>编写 Spring Security 配置类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//AOP 拦截器</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//授权</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//首页所有人都可以访问 功能页只能有对应权限的人才能访问</span></span><br><span class="line"></span><br><span class="line">        http.authorizeRequests()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/&quot;</span>).permitAll()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/level1/**&quot;</span>).hasRole(<span class="string">&quot;vip1&quot;</span>)</span><br><span class="line">                .antMatchers(<span class="string">&quot;/level2/**&quot;</span>).hasRole(<span class="string">&quot;vip2&quot;</span>)</span><br><span class="line">                .antMatchers(<span class="string">&quot;/level3/**&quot;</span>).hasRole(<span class="string">&quot;vip3&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//没有权限会默认到登录界面 需要开启登录的页面</span></span><br><span class="line">        <span class="comment">// .loginPage(&quot;&quot;) 定制登录页 参数为跳转登录页的请求</span></span><br><span class="line">        http.formLogin().loginPage(<span class="string">&quot;/toLogin&quot;</span>).usernameParameter(<span class="string">&quot;username&quot;</span>).passwordParameter(<span class="string">&quot;password&quot;</span>).loginProcessingUrl(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//关闭防攻击</span></span><br><span class="line">        http.csrf().disable();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//注销 开启了注销功能 跳到首页</span></span><br><span class="line">        http.logout().logoutSuccessUrl(<span class="string">&quot;/&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//开启 &#x27;记住我&#x27; 功能 cookie 默认保存两周</span></span><br><span class="line">        http.rememberMe().rememberMeParameter(<span class="string">&quot;remmeber&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//认证 SpringBoot 2.1.x 可以直接使用</span></span><br><span class="line">    <span class="comment">//密码编码: PasswordEncoder</span></span><br><span class="line">    <span class="comment">//在 Spring Security 5.0+ 新增了很多加密方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//从数据库中认证</span></span><br><span class="line">        <span class="comment">//auth.jdbcAuthentication();</span></span><br><span class="line">        <span class="comment">//从内存中认证</span></span><br><span class="line">        <span class="comment">//这些数据正常应该在数据库读</span></span><br><span class="line">        auth.inMemoryAuthentication().passwordEncoder(<span class="keyword">new</span> BCryptPasswordEncoder())</span><br><span class="line">                .withUser(<span class="string">&quot;Cu1&quot;</span>).password(<span class="keyword">new</span> BCryptPasswordEncoder().encode(<span class="string">&quot;123456&quot;</span>)).roles(<span class="string">&quot;vip2&quot;</span>, <span class="string">&quot;vip3&quot;</span>)</span><br><span class="line">                .and()</span><br><span class="line">                .withUser(<span class="string">&quot;root&quot;</span>).password(<span class="keyword">new</span> BCryptPasswordEncoder().encode(<span class="string">&quot;123456&quot;</span>)).roles(<span class="string">&quot;vip1&quot;</span>, <span class="string">&quot;vip2&quot;</span>, <span class="string">&quot;vip3&quot;</span>)</span><br><span class="line">                .and()</span><br><span class="line">                .withUser(<span class="string">&quot;guest&quot;</span>).password(<span class="keyword">new</span> BCryptPasswordEncoder().encode(<span class="string">&quot;123456&quot;</span>)).roles(<span class="string">&quot;vip1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>**下面将上面的代码拆分解释一下: **</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebSecuritypublic</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span></span></span><br></pre></td></tr></table></figure>

<p><code>@EnableWebSecurity</code> 配合  继承 <code>WebSecurityConfigurerAdapter</code> 就可以达到开启 <code>Spring Security</code> 的自定义配置</p>
<p>部分自定义配置功能以重写 <code>WebSecurityConfigurerAdapter</code> 中的方法来实现</p>
<ol>
<li><p><code>protected void configure(HttpSecurity http) throws Exception</code> 用来配置用户访问 url 的权限</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//授权</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       <span class="comment">//首页所有人都可以访问 功能页只能有对应权限的人才能访问</span></span><br><span class="line">   </span><br><span class="line">       http.authorizeRequests()</span><br><span class="line">               .antMatchers(<span class="string">&quot;/&quot;</span>).permitAll()</span><br><span class="line">               .antMatchers(<span class="string">&quot;/level1/**&quot;</span>).hasRole(<span class="string">&quot;vip1&quot;</span>)</span><br><span class="line">               .antMatchers(<span class="string">&quot;/level2/**&quot;</span>).hasRole(<span class="string">&quot;vip2&quot;</span>)</span><br><span class="line">               .antMatchers(<span class="string">&quot;/level3/**&quot;</span>).hasRole(<span class="string">&quot;vip3&quot;</span>);</span><br><span class="line">   </span><br><span class="line">       <span class="comment">//没有权限会默认到登录界面 需要开启登录的页面</span></span><br><span class="line">       <span class="comment">// .loginPage(&quot;&quot;) 定制登录页 参数为跳转登录页的请求</span></span><br><span class="line">       http.formLogin().loginPage(<span class="string">&quot;/toLogin&quot;</span>).usernameParameter(<span class="string">&quot;username&quot;</span>).passwordParameter(<span class="string">&quot;password&quot;</span>).loginProcessingUrl(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">   </span><br><span class="line">       <span class="comment">//关闭防攻击</span></span><br><span class="line">       http.csrf().disable();</span><br><span class="line">   </span><br><span class="line">       <span class="comment">//注销 开启了注销功能 跳到首页</span></span><br><span class="line">       http.logout().logoutSuccessUrl(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">   </span><br><span class="line">       <span class="comment">//开启 &#x27;记住我&#x27; 功能 cookie 默认保存两周</span></span><br><span class="line">       http.rememberMe().rememberMeParameter(<span class="string">&quot;remmeber&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>关于 <code>loginProcessingUrl(&quot;/login&quot;) </code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http.formLogin().loginPage(<span class="string">&quot;/toLogin&quot;</span>).usernameParameter(<span class="string">&quot;username&quot;</span>).passwordParameter(<span class="string">&quot;password&quot;</span>).loginProcessingUrl(<span class="string">&quot;/login&quot;</span>);</span><br></pre></td></tr></table></figure>

<p> <code>loginProcessingUrl(&quot;/login&quot;)</code>  表示登录页提交信息的时候是以 <code>“/login”</code> 的 <code>URL</code> 向 <code>Spring Security</code>   并由登录界面 <code>&lt;form th:action=&quot;@&#123;/login&#125;&quot; method=&quot;post&quot;&gt;</code> 以 之前设定好的 <strong>URL</strong> 向后台提交数据来由 <code>Spring Security</code> 实现的权限验证功能进行验证 但是在验证成功后有下面两种结果:</p>
<ul>
<li>通过主动点击登录 <strong>(指进入没有权限的页面导致跳转至登录界面)</strong> 进行登陆时, 点击登录并由后台验证通过后将自动回到 当前界面</li>
<li>进入没有权限的页面导致跳转至登录界面登录成功且权限符合当前页面的权限后会进入该页面</li>
</ul>
<p>写完发现好像登录成功后不论之前进入的是有没有权限的页面 都会自动回到进入之前的页面….</p>
<ol start="2">
<li><p><code>protected void configure(AuthenticationManagerBuilder auth) throws Exception</code> 记录合法的登录信息 用来在后台进行匹配</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//认证 SpringBoot 2.1.x 可以直接使用</span></span><br><span class="line">   <span class="comment">//密码编码: PasswordEncoder</span></span><br><span class="line">   <span class="comment">//在 Spring Security 5.0+ 新增了很多加密方法</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       <span class="comment">//从数据库中认证</span></span><br><span class="line">       <span class="comment">//auth.jdbcAuthentication();</span></span><br><span class="line">       <span class="comment">//从内存中认证</span></span><br><span class="line">       <span class="comment">//这些数据正常应该在数据库读</span></span><br><span class="line">       auth.inMemoryAuthentication().passwordEncoder(<span class="keyword">new</span> BCryptPasswordEncoder())</span><br><span class="line">               .withUser(<span class="string">&quot;Cu1&quot;</span>).password(<span class="keyword">new</span> BCryptPasswordEncoder().encode(<span class="string">&quot;123456&quot;</span>)).roles(<span class="string">&quot;vip2&quot;</span>, <span class="string">&quot;vip3&quot;</span>)</span><br><span class="line">               .and()</span><br><span class="line">               .withUser(<span class="string">&quot;root&quot;</span>).password(<span class="keyword">new</span> BCryptPasswordEncoder().encode(<span class="string">&quot;123456&quot;</span>)).roles(<span class="string">&quot;vip1&quot;</span>, <span class="string">&quot;vip2&quot;</span>, <span class="string">&quot;vip3&quot;</span>)</span><br><span class="line">               .and()</span><br><span class="line">               .withUser(<span class="string">&quot;guest&quot;</span>).password(<span class="keyword">new</span> BCryptPasswordEncoder().encode(<span class="string">&quot;123456&quot;</span>)).roles(<span class="string">&quot;vip1&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<p>现在有一个需求: 用户没有登录的时候, 导航栏上只显示登录按钮, 用户登录之后, 导航栏可以显示登录的用户信息及注销按钮. 以及下面的功能: 比如 <code>Cu1</code> 这个用户, 其只有 <code>vip2</code>,<code> vip3</code> 功能, 那么登录则只显示这两个功能, 而 <code>vip1</code> 的功能菜单不显示.</p>
<p>实现上面的需求需要结合 <code>thymeleaf</code> 中的一些功能</p>
<p><code>sec：authorize=”isAuthenticated()</code> :是否认证登录！来显示不同的页面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ui segment&quot;</span> <span class="attr">id</span>=<span class="string">&quot;index-header-nav&quot;</span> <span class="attr">th:fragment</span>=<span class="string">&quot;nav-menu&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ui secondary menu&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>  <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/index&#125;&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">           <span class="comment">&lt;!--登录注销--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right menu&quot;</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--如果未登录--&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--&lt;a class=&quot;item&quot; th:href=&quot;@&#123;/toLogin&#125;&quot;&gt;</span></span><br><span class="line"><span class="comment">                   &lt;i class=&quot;address card icon&quot;&gt;&lt;/i&gt; 登录</span></span><br><span class="line"><span class="comment">               &lt;/a&gt;--&gt;</span></span><br><span class="line">      </span><br><span class="line">               <span class="tag">&lt;<span class="name">div</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;!isAuthenticated()&quot;</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/toLogin&#125;&quot;</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;sign-out icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 登录</span><br><span class="line">                   <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">               <span class="comment">&lt;!--如果注销 用户名和注销按钮--&gt;</span></span><br><span class="line">              <span class="comment">&lt;!-- &lt;a class=&quot;item&quot; th:href=&quot;@&#123;/logout&#125;&quot;&gt;</span></span><br><span class="line"><span class="comment">                   &lt;i class=&quot;sign-out icon&quot;&gt;&lt;/i&gt; 注销</span></span><br><span class="line"><span class="comment">               &lt;/a&gt;--&gt;</span></span><br><span class="line">      </span><br><span class="line">               <span class="tag">&lt;<span class="name">div</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;isAuthenticated()&quot;</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">                       用户名: <span class="tag">&lt;<span class="name">span</span> <span class="attr">sec:authentication</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">               <span class="tag">&lt;<span class="name">div</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;isAuthenticated()&quot;</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/logout&#125;&quot;</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;sign-out icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 注销</span><br><span class="line">                   <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">           <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>sec:authentication=&quot;name&quot;</code> 获取登录时用户名</p>
<p>关于根据权限决定是否显示 这里只举一个例子</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--菜单根据用户的角色动态的实现--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;column&quot;</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;hasRole(&#x27;vip1&#x27;)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ui raised segment&quot;</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ui&quot;</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h5</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span>Level 1<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">         		<span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/level1/1&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> Level-1-1<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/level1/2&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> Level-1-2<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>            </span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/level1/3&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> Level-1-3<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>sec:authorize=&quot;hasRole(&#39;vip1&#39;)&quot;</code> 判断该用户是否有 <code>vip1</code> 的权限</p>
<p>==<strong>问题:</strong>==</p>
<p>​    如果现在依旧按照视频中的配置进行配置的话会发现 <code>thymeleaf</code> 提供的这个功能并没有生效</p>
<p>视频中选择的是降低版本 这种行为我不提倡. 其实出现这个问题的原因在于 <code>thymeleaf</code> 和 <code>thymeleaf-extras-springsecurity</code> 以及 <code>Spring Security</code> 的版本不兼容出现的问题</p>
<p>这里给出 <a target="_blank" rel="noopener" href="https://github.com/thymeleaf/thymeleaf-extras-springsecurity">thymeleaf 官方文档</a> 和 <a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000021529294">一篇文章</a> 可以去阅读一下 如果使用的是上面提供的 <code>pom.xml</code> 中的依赖应该是没有问题的</p>
</li>
</ol>
</li>
</ol>
<h2 id="8、Shrio"><a href="#8、Shrio" class="headerlink" title="8、Shrio"></a>8、Shrio</h2><p><a target="_blank" rel="noopener" href="https://shiro.apache.org/">官方文档</a></p>
<h3 id="提前了解一些什么"><a href="#提前了解一些什么" class="headerlink" title="提前了解一些什么"></a>提前了解一些什么</h3><h4 id="了解-Shiro-的三大对象"><a href="#了解-Shiro-的三大对象" class="headerlink" title="了解 Shiro 的三大对象"></a>了解 <code>Shiro </code>的三大对象</h4><ul>
<li><p><code>Subject</code>：<strong>当前用户</strong>（与当前应用交互的任何东西）—所有 <code>Subject</code> 都绑定到 <code>SecurityManager</code>，与 <code>Subject</code> 的所有交互都会委托给 <code>SecurityManager</code>；可以把 <code>Subject</code>认为是一个门面；<code>SecurityManager</code> 才是实际的执行者；</p>
</li>
<li><p><code>SecurityManager</code> :  <strong>管理所有用户</strong>，负责与后边介绍的其他组件进行交互</p>
</li>
<li><p><code>Realm</code>: <strong>安全数据源用于认证和授权</strong>，<code>Shiro</code> 从 <code>Realm</code> 获取安全数据（如用户、角色、权限），就是说 <code>SecurityManager</code> 要验证用户身份，那么它需要从 Realm 获取相应的用户进行比较以确定用户身份是否合法；也需要从 <code>Realm</code> 得到用户相应的角色 / 权限进行验证.</p>
</li>
</ul>
<p><img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/05/08/kuangstudya7f8c589-083f-4d74-9bb8-b02214c5048e.png" alt="img"></p>
<p><img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/03/23/kuangstudy7288ba59-90d0-4df9-af44-4834ebed5f21.jpg" alt="img"></p>
<p><strong>总结</strong>：Subject表示当前用户，Security Manager管理所有用户，负责用户与其他组件的交互（认证，授权，Session管理..），从Realm中获取数据.</p>
<h3 id="SpringBoot-整合-Shrio"><a href="#SpringBoot-整合-Shrio" class="headerlink" title="SpringBoot 整合 Shrio"></a>SpringBoot 整合 Shrio</h3><h4 id="导入-Shrio-的包"><a href="#导入-Shrio-的包" class="headerlink" title="导入 Shrio 的包"></a>导入 <code>Shrio</code> 的包</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.shiro/shiro-spring --&gt;</span><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="配置-Shrio-的配置类"><a href="#配置-Shrio-的配置类" class="headerlink" title="配置 Shrio 的配置类"></a>配置 <code>Shrio</code> 的配置类</h4><p> 由上面的前置芝士可以发现 要使用 <code>Shrio</code> 就必须要有 <code>Subject</code> , <code>SecurityManager</code>,  <code>Realm</code> 三层结构的配置所以在 <code>SpringBoot</code> 的配置包下需要有这些结构</p>
<p>由于 <code>Reaml</code> 层是没有默认实现的, 所以需要用户自己自定义的 所以需要用户自己去实现一个配置类</p>
<p>关于 <code>UserRealm</code> (用于了登录时的 <strong>认证</strong> 和 <strong>授权</strong>) 配置类的自定义实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义的 realm</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	继承了 AuthorizingRealm 就可以被 SpringBoot 认为是一个Realm 层的实现</span></span><br><span class="line"><span class="comment">	而且必须要实现两个方法 </span></span><br><span class="line"><span class="comment">		1.protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principalCollection) 实现在用户进行登陆时给与用户相应的权限</span></span><br><span class="line"><span class="comment">        2.rotected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken authenticationToken) throws AuthenticationException  实现用户在提交登录表单后进行后台的验证验证用户的用户名密码是否正确</span></span><br><span class="line"><span class="comment">    具体某些认证授权方法在下面代码中有说明和解释</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//授权</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//执行授权</span></span><br><span class="line">        SimpleAuthorizationInfo info = <span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//拿到当前登录的这个对象</span></span><br><span class="line">        Subject subject = SecurityUtils.getSubject();</span><br><span class="line">        User currentUser = (User) subject.getPrincipal(); <span class="comment">//拿到 user 对象</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置当前用户权限</span></span><br><span class="line">        info.addStringPermission(currentUser.getPerms());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//认证</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken authenticationToken)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line"></span><br><span class="line">        UsernamePasswordToken userToken = (UsernamePasswordToken) authenticationToken;</span><br><span class="line">        <span class="comment">//密码认证, Shiro 来做</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//连接真实数据库</span></span><br><span class="line">        User user = userService.queryUserByName(userToken.getUsername());</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Subject currentUser = SecurityUtils.getSubject();</span><br><span class="line">        Session session = currentUser.getSession();</span><br><span class="line">        session.setAttribute(<span class="string">&quot;loginUser&quot;</span>, user);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SimpleAuthenticationInfo(user, user.getPwd(),<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>ShrioConfig</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">关于用户访问某个 url 时的拦截要求//</span><br><span class="line">添加 Shiro 的内置过滤器</span><br><span class="line">//添加 Shiro 的内置过滤器</span><br><span class="line">/*</span><br><span class="line">* anno 无需认证就可以访问</span><br><span class="line">* authc 必须认证了才能访问</span><br><span class="line">* user 必修拥有 记住我 功能才能使用</span><br><span class="line">* perms 拥有对某个资源的权限才能访问</span><br><span class="line">* role 拥有某个角色权限才能访问</span><br><span class="line">* */</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class ShiroConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    //ShiroFilterFactoryBean step 2</span><br><span class="line">    public ShiroFilterFactoryBean getShiroFilterFactoryBean(</span><br><span class="line">            @Qualifier(&quot;getDefaultWebSecurityManager&quot;) DefaultWebSecurityManager defaultWebSecurityManager) &#123;</span><br><span class="line">        ShiroFilterFactoryBean shiroFilterFactoryBean = new ShiroFilterFactoryBean();</span><br><span class="line">        //设置安全管理器</span><br><span class="line">        shiroFilterFactoryBean.setSecurityManager(defaultWebSecurityManager);</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        Map&lt;String, String&gt; filterMap = new LinkedHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        //拦截</span><br><span class="line">        /*filterMap.put(&quot;/user/add&quot;, &quot;authc&quot;);</span><br><span class="line">        filterMap.put(&quot;/user/update&quot;, &quot;authc&quot;);*/</span><br><span class="line"></span><br><span class="line">        //授权 正常情况下 没有授权会跳转到 未授权页面</span><br><span class="line">        filterMap.put(&quot;/user/add&quot;, &quot;perms[user:add]&quot;);</span><br><span class="line">        filterMap.put(&quot;/user/update&quot;, &quot;perms[user:update]   &quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        shiroFilterFactoryBean.setFilterChainDefinitionMap(filterMap);</span><br><span class="line"></span><br><span class="line">        //设置返回登录页面的请求</span><br><span class="line">        shiroFilterFactoryBean.setLoginUrl(&quot;/toLogin&quot;);</span><br><span class="line"></span><br><span class="line">        //设置未授权页面</span><br><span class="line">        shiroFilterFactoryBean.setUnauthorizedUrl(&quot;/noauth&quot;);</span><br><span class="line"></span><br><span class="line">        return shiroFilterFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //DafaultWebSecurityManager step 2</span><br><span class="line">    @Bean(name = &quot;getDefaultWebSecurityManager&quot;)</span><br><span class="line">    public DefaultWebSecurityManager getDefaultWebSecurityManager(@Qualifier(&quot;userRealm&quot;) UserRealm userRealm) &#123;</span><br><span class="line">        DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager();</span><br><span class="line">        //关联 UserRealm</span><br><span class="line">        securityManager.setRealm(userRealm);</span><br><span class="line">        return securityManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //创建 realm 对象 需要自定义 step 1</span><br><span class="line">    @Bean(name = &quot;userRealm&quot;)</span><br><span class="line">    public UserRealm userRealm() &#123; return new UserRealm(); &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    //整合 ShiroDialect : 用来整合 Shiro 和 thymeleaf</span><br><span class="line">    public ShiroDialect getShiroDialect() &#123;</span><br><span class="line">        return new ShiroDialect();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于 <code>SpringBoot</code> 为用户提供了默认实现的 <code>SecurityManager</code> 和 <code>ShiroFilterFactoryBean</code> ，所以不需要用户先提供自定义的类才能将其配置类放置进 <code>SpringBoot</code> 的容器中 PS( <code>@Bean(name=“xxx”) </code>表示可以不使用 <code>Spring</code> 容器提供的默认名称, 而是指定 <code>Spring</code> 容器中的对象名称为 <code>“xxx”</code>)</p>
<h3 id="Shrio-整合-MyBatis"><a href="#Shrio-整合-MyBatis" class="headerlink" title="Shrio 整合 MyBatis"></a>Shrio 整合 MyBatis</h3><h4 id="导入-MySQL-Druid-MyBatis-的-pom-依赖"><a href="#导入-MySQL-Druid-MyBatis-的-pom-依赖" class="headerlink" title="导入 MySQL  Druid, MyBatis 的 pom 依赖"></a>导入 <code>MySQL</code>  <code>Druid</code>, <code>MyBatis</code> 的 <code>pom</code> 依赖</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--druid 数据源--&gt;</span><br><span class="line">        &lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;druid&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.2.6&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!--链接 Mysql 驱动--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- https://mvnrepository.com/artifact/log4j/log4j --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.2.17&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--mybatis 整合 mybatis-spring-boot-starter 非 SpringBoot 官方--&gt;</span><br><span class="line">        &lt;!-- https://mvnrepository.com/artifact/org.mybatis.spring.boot/mybatis-spring-boot-starter --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.2.0&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="配置-MyBatis-配置文件"><a href="#配置-MyBatis-配置文件" class="headerlink" title="配置 MyBatis 配置文件"></a>配置 <code>MyBatis</code> 配置文件</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> </span><br><span class="line">    <span class="attr">password:</span> </span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://47.100.227.175:3306/School?useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="comment"># 配置 druid 数据源</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#Spring Boot</span></span><br><span class="line">    <span class="comment">#druid</span></span><br><span class="line">    <span class="attr">initialSize:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">minIdle:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">maxActive:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">maxWait:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">timeBetweenEvictionRunsMillis:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">minEvictableIdleTimeMillis:</span> <span class="number">300000</span></span><br><span class="line">    <span class="attr">validationQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">DUAL</span></span><br><span class="line">    <span class="attr">testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">testOnBorrow:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">testOnReturn:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">poolPreparedStatements:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="attr">filters:</span> <span class="string">stat,wall,log4j</span></span><br><span class="line">    <span class="attr">maxPoolPreparedStatementPerConnectionSize:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">useGlobalDataSourceStat:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">connectionProperties:</span> <span class="string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置 MyBatis</span></span><br><span class="line"><span class="meta">mybatis.mapper-locations</span>=<span class="string">classpath:mybatis/mapper/*.xml</span></span><br></pre></td></tr></table></figure>

<p>**总结: ** 其实和之前整合数据库时没有什么区别</p>
<h3 id="Shrio-整合-thymeleaf"><a href="#Shrio-整合-thymeleaf" class="headerlink" title="Shrio 整合 thymeleaf"></a>Shrio 整合 thymeleaf</h3><h4 id="导入-pom-依赖"><a href="#导入-pom-依赖" class="headerlink" title="导入 pom 依赖"></a>导入 <code>pom</code> 依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--shiro-thymeleaf 整合--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.github.theborakompanioni/thymeleaf-extras-shiro --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.theborakompanioni<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-shiro<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="在-html-文件上加入命名空间"><a href="#在-html-文件上加入命名空间" class="headerlink" title="在 html 文件上加入命名空间"></a><strong>在 <code>html</code> 文件上加入命名空间</strong></h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:sec</span>=<span class="string">&quot;http://www.thymeleaf.org/extras/spring-security&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:shiro</span>=<span class="string">&quot;http://www.pollix.at/thymeleaf/shiro&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Shrio-与-thymeleaf-在-html-中的使用"><a href="#Shrio-与-thymeleaf-在-html-中的使用" class="headerlink" title="Shrio 与 thymeleaf 在 html 中的使用"></a><code>Shrio</code> 与 <code>thymeleaf</code> 在 <code>html</code> 中的使用</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:sec</span>=<span class="string">&quot;http://www.thymeleaf.org/extras/spring-security&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:shiro</span>=<span class="string">&quot;http://www.pollix.at/thymeleaf/shiro&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;msg&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">shiro:hasPermission</span>=<span class="string">&quot;user:add&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/user/add&#125;&quot;</span>&gt;</span>add<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">shiro:hasPermission</span>=<span class="string">&quot;user:update&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/user/update&#125;&quot;</span>&gt;</span>update<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;session.loginUser==null&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/toLogin&#125;&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;logout&#125;&quot;</span>&gt;</span>注销<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Shrio-在-SpringBoot-中的使用"><a href="#Shrio-在-SpringBoot-中的使用" class="headerlink" title="Shrio 在 SpringBoot 中的使用"></a><code>Shrio</code> 在 <code>SpringBoot</code> 中的使用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">public class MyController &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&#123; &quot;/&quot;, &quot;/index&quot;&#125;)</span><br><span class="line">    public String toIndex(Model model) &#123;</span><br><span class="line">        model.addAttribute(&quot;msg&quot;, &quot;hello shiro&quot;);</span><br><span class="line">        return &quot;index&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/user/add&quot;)</span><br><span class="line">    public String add() &#123; return &quot;User/add&quot;; &#125;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/user/update&quot;)</span><br><span class="line">    public String update() &#123;</span><br><span class="line">        return &quot;User/update&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/toLogin&quot;)</span><br><span class="line">    public String toLogin() &#123; return &quot;login&quot;; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/login&quot;)</span><br><span class="line">    public String login(String username,</span><br><span class="line">                        String  password, Model model) &#123;</span><br><span class="line">        //获取当前用户</span><br><span class="line">        Subject subject = SecurityUtils.getSubject();</span><br><span class="line">        //封装用户的登录数据</span><br><span class="line">        UsernamePasswordToken token = new UsernamePasswordToken(username, password);</span><br><span class="line">        try &#123;</span><br><span class="line">            subject.login(token); //执行登录的方法 如果没有异常就说明可以了</span><br><span class="line">            return &quot;redirect:/index&quot;;</span><br><span class="line">        &#125; catch (UnknownAccountException e) &#123; //用户名不存在</span><br><span class="line">            model.addAttribute(&quot;msg&quot;,&quot;用户名错误&quot;);</span><br><span class="line">            return &quot;login&quot;;</span><br><span class="line">        &#125; catch (IncorrectCredentialsException e) &#123; //密码不存在</span><br><span class="line">            model.addAttribute(&quot;msg&quot;, &quot;密码错误&quot;);</span><br><span class="line">            return &quot;login&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/noauth&quot;)</span><br><span class="line">    @ResponseBody</span><br><span class="line">    public String unAuthorized() &#123;</span><br><span class="line">        return &quot;未经授权无法访问此页面&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //注销</span><br><span class="line">    @RequestMapping(&quot;/logout&quot;)</span><br><span class="line">    public String logout() &#123;</span><br><span class="line">        Subject currentUser = SecurityUtils.getSubject();</span><br><span class="line">        currentUser.logout();</span><br><span class="line">        return &quot;redirect:/index&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="扩展："><a href="#扩展：" class="headerlink" title="扩展："></a>扩展：</h3><ul>
<li><p><a target="_blank" rel="noopener" href="https://github.com/qualifier">@qualifier </a>注解消除依赖注入冲突（当 <code>SpringBoot</code> 注入了相同的 <code>Bean/Componet</code> ），可以指明我们要用哪个</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/primary">@primary</a> 可以设置优先级</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://shiro.apache.org/java-authorization-guide.html">https://shiro.apache.org/java-authorization-guide.html</a> 更多安全控制</p>
</li>
<li><p><code>thymeleaf</code> 整合 <code>shiro</code> 的标签</p>
<p><code>guest</code> 标签<br>　　<a href="shiro:guest">shiro:guest</a><br>　　</shiro:guest><br>　　用户没有身份验证时显示相应信息，即游客访问信息。</p>
<p><code>user</code> 标签<br>　　<a href="shiro:user">shiro:user</a>　　<br>　　</shiro:user><br>　　用户已经身份验证/记住我登录后显示相应的信息。</p>
<p><code>authenticated</code>标签<br>　　<a href="shiro:authenticated">shiro:authenticated</a>　　<br>　　</shiro:authenticated><br>　　用户已经身份验证通过，即 <code>Subject.login</code> 登录成功，不是记住我登录的。</p>
<p><code>notAuthenticated</code> 标签<br>　　<a href="shiro:notAuthenticated">shiro:notAuthenticated</a><br>　　<br>　　</shiro:notAuthenticated><br>　　用户已经身份验证通过，即没有调用 <code>Subject.login </code>进行登录，包括记住我自动登录的也属于未进行身份验证。</p>
<p><code>principal</code> 标签<br>　　<code>&lt;shiro: principal/&gt;</code><br><code>　　&lt;shiro:principal property=&quot;username&quot;/&gt;</code>　　</p>
<p>相当于 <code>((User)Subject.getPrincipals()).getUsername()</code> 。</p>
<p><code>lacksPermission</code> 标签<br>　　<code>&lt;shiro:lacksPermission name=&quot;org:create&quot;&gt;</code><br>　<br>　　</shiro:lacksPermission><br>　　如果当前 <code>Subject </code>没有权限将显示 <code>body</code> 体内容。</p>
<p><code>hasRole</code> 标签<br>　　<code>&lt;shiro:hasRole name=&quot;admin&quot;&gt;　　</code><br>　　</shiro:hasRole><br>　　如果当前 <code>Subject</code> 有角色将显示 <code>body</code> 体内容。</p>
<p><code>hasAnyRoles</code> 标签<br>　　<code>&lt;shiro:hasAnyRoles name=&quot;admin,user&quot;&gt;</code><br>　　　<br>　　</shiro:hasAnyRoles><br>　　如果当前 <code>Subject </code>有任意一个角色（或的关系）将显示 <code>body</code> 体内容。</p>
<p><code>lacksRole</code> 标签<br>　　<code>&lt;shiro:lacksRole name=&quot;abc&quot;&gt;</code>　　<br>　　</shiro:lacksRole><br>　　如果当前 <code>Subject </code>没有角色将显示 <code>body </code>体内容。</p>
<p><code>hasPermission </code>标签<br>　　<code>&lt;shiro:hasPermission name=&quot;user:create&quot;&gt;</code>　　<br>　　</shiro:hasPermission><br>　　如果当前 <code>Subject </code>有权限将显示 <code>body</code> 体内容</p>
<p>验证当前用户是否拥有指定权限<br><a shiro:hasPermission="user:add" href="">添加</a></p>
</li>
</ul>
<h2 id="9、Swagger"><a href="#9、Swagger" class="headerlink" title="9、Swagger"></a>9、Swagger</h2><h4 id="Swagger简介"><a href="#Swagger简介" class="headerlink" title="Swagger简介"></a>Swagger简介</h4><blockquote>
<p>前后端分离时代</p>
</blockquote>
<p>前端：控制层和视图层<br>后端：控制层，数据访问层，服务层</p>
<p><strong>特点：</strong><br>前端调用 &gt;— 后端的API接口<br>即：松耦合</p>
<p><strong>产生的问题：</strong><br>前端和后端工作人员之间的交互问题（武器的变多）</p>
<p><strong>解决</strong><br>Swagger的诞生！</p>
<h4 id="Swagger是什么？"><a href="#Swagger是什么？" class="headerlink" title="Swagger是什么？"></a>Swagger是什么？</h4><ul>
<li>号称世界上最流行的API框架</li>
<li>Restful Api 文档在线自动生成器 =&gt; API 文档 与API 定义同步更新</li>
<li>直接运行，在线测试API</li>
<li>支持多种语言 （如：Java，PHP等）</li>
<li>官网：<a target="_blank" rel="noopener" href="https://swagger.io/">https://swagger.io/</a></li>
</ul>
<h4 id="SpringBoot-整合-Swagger"><a href="#SpringBoot-整合-Swagger" class="headerlink" title="SpringBoot 整合 Swagger"></a><code>SpringBoot</code> 整合 <code>Swagger</code></h4><h5 id="导入-pom-依赖-1"><a href="#导入-pom-依赖-1" class="headerlink" title="导入 pom 依赖"></a>导入 pom 依赖</h5><h4 id="编写-Swagger-配置类"><a href="#编写-Swagger-配置类" class="headerlink" title="编写 Swagger 配置类"></a>编写 <code>Swagger</code> 配置类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//开启 swagger2</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置 Swagger 的 docket 的 bean 实例</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">docket</span><span class="params">(Environment environment)</span></span>&#123;</span><br><span class="line">        <span class="comment">//设置要显示 Swagger 环境</span></span><br><span class="line">        Profiles profiles = Profiles.of(<span class="string">&quot;dev&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">        <span class="comment">//获取项目环境:</span></span><br><span class="line">        <span class="comment">//通过 environment.acceptsProfiles(profiles) 判断是否处在自己设定的环境之中</span></span><br><span class="line">        <span class="keyword">boolean</span> flag = environment.acceptsProfiles(profiles);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .groupName(<span class="string">&quot;cu1&quot;</span>)</span><br><span class="line">                <span class="comment">//enalbe 是否启用 Swagger 如果为 False 则 Swagger 不能在浏览器中访问</span></span><br><span class="line">                .enable(flag)</span><br><span class="line">                .select()</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                * basePackage() 配置要扫描接口的方式 basePackage() 基于某个包扫描</span></span><br><span class="line"><span class="comment">                * any() 扫描全部</span></span><br><span class="line"><span class="comment">                * none() 都不扫描</span></span><br><span class="line"><span class="comment">                * 表示只会扫描类上有 @RestController 注解的接口</span></span><br><span class="line"><span class="comment">                * withClassAnnotation(RestController.class) 扫描类上的注解 参数是一个注解的反射对象</span></span><br><span class="line"><span class="comment">                * withMethodAnnotation(GetMapping.class) 扫描方法上的注解</span></span><br><span class="line"><span class="comment">                * */</span></span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.cu1.swagger.Controller&quot;</span>))</span><br><span class="line">                <span class="comment">//过滤路径 表示不扫描 某个路径下的所有文件</span></span><br><span class="line">                <span class="comment">//.paths(PathSelectors.ant(&quot;/cu1/**&quot;))</span></span><br><span class="line">                .build(); <span class="comment">//工厂模式</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置 Swagger 信息</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//作者信息</span></span><br><span class="line">        Contact contact = <span class="keyword">new</span> Contact(<span class="string">&quot;Cu1&quot;</span>,</span><br><span class="line">                <span class="string">&quot;https://blog.csdn.net/CUCUC1?spm=1000.2115.3001.5343&quot;</span>,</span><br><span class="line">                <span class="string">&quot;cu1universe@gmail.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfo(<span class="string">&quot;Cu1&#x27;s SwaggerAPI document&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Wuhu Qifei&quot;</span>,</span><br><span class="line">                <span class="string">&quot;1.0&quot;</span>,</span><br><span class="line">                <span class="string">&quot;https://blog.csdn.net/CUCUC1?spm=1000.2115.3001.5343&quot;</span>,</span><br><span class="line">                contact,</span><br><span class="line">                <span class="string">&quot;Apache 2.0&quot;</span>,</span><br><span class="line">                <span class="string">&quot;http://www.apache.org/licenses/LICENSE-2.0&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> ArrayList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/hello&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">Hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//只要接口中返回值中存在实体类 它就会被扫描</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/user&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">user</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Operation 接口 不是放在类上 是放在方法上 给接口方法提供注释</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;Hello 控&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello2&quot;)</span></span><br><span class="line">    <span class="comment">//@ApiParam(&quot;用户名&quot;) 给接口参数加注释</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(<span class="meta">@ApiParam(&quot;用户名&quot;)</span> String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span> + username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;post 测试&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/postt&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">postt</span><span class="params">(<span class="meta">@ApiParam(&quot;用户名&quot;)</span> User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="常用注解"><a href="#常用注解" class="headerlink" title="常用注解"></a>常用注解</h4><p>Swagger的所有注解定义在io.swagger.annotations包下</p>
<p>下面列一些经常用到的，未列举出来的可以另行查阅说明：</p>
<table>
<thead>
<tr>
<th>Swagger注解</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://github.com/ApiModel">@ApiModel</a>（”说明这是什么类”）</td>
<td>用于pojo下的实体类</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/ApiModelProperty">@ApiModelProperty</a>(value=”属性说明”,hidden=ture)</td>
<td>用于实体类下的属性，hidden为true表示可以隐藏</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/Api">@Api</a>(“模块说明”)</td>
<td>用于controller层继续模块说明</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/ApiOperation">@ApiOperation</a>（”方法说明”）</td>
<td>用于controller层下的方法</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/ApiParm">@ApiParm</a>(“参数说明”)</td>
<td>用于controller层下的方法参数</td>
</tr>
</tbody></table>
<h4 id="希望-Swagger-在生产环境中使用-在发布后不能使用"><a href="#希望-Swagger-在生产环境中使用-在发布后不能使用" class="headerlink" title="希望 Swagger 在生产环境中使用 在发布后不能使用"></a>希望 <code>Swagger</code> 在生产环境中使用 在发布后不能使用</h4><ul>
<li>判断是不是生产环境 <code>flag = false</code></li>
<li>注入 <code>enable(flag)</code></li>
</ul>
<h4 id="配置-API-文档分组"><a href="#配置-API-文档分组" class="headerlink" title="配置 API 文档分组"></a>配置 <code>API</code> 文档分组</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.groupName(<span class="string">&quot;cu1&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>配置多个 <code>API</code> 文档 向 <code>Spring</code> 容器中配置多个 <code>Docket</code> 实例即可</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结:"></a><strong>总结:</strong></h4><ol>
<li><p>可以通过 <code>Swagger</code> 给一些比较难理解的属性或者接口, 增加注释信息</p>
</li>
<li><p>接口文档实时更新</p>
</li>
<li><p>可以在线测试</p>
</li>
</ol>
<h4 id="注意点-在正式发布时-关闭-Swagger-出于安全考虑-而且节省内存空间"><a href="#注意点-在正式发布时-关闭-Swagger-出于安全考虑-而且节省内存空间" class="headerlink" title="注意点 : 在正式发布时 关闭 Swagger 出于安全考虑 而且节省内存空间"></a><strong>注意点</strong> : 在正式发布时 关闭 <code>Swagger</code> 出于安全考虑 而且节省内存空间</h4><h4 id="扩展：皮肤！！"><a href="#扩展：皮肤！！" class="headerlink" title="扩展：皮肤！！"></a>扩展：皮肤！！</h4><p>我们可以导入不同的包实现不同的皮肤定义：</p>
<ol>
<li>默认的 访问 <a target="_blank" rel="noopener" href="http://localhost:8080/swagger-ui.html">http://localhost:8080/swagger-ui.html</a></li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入swagger-ui-layer包 /docs.html--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.caspar-chen<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-ui-layer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>bootstrap-ui 访问 <a target="_blank" rel="noopener" href="http://localhost:8080/doc.html">http://localhost:8080/doc.html</a></li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入swagger-ui-layer包 /document.html--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zyplayer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-mg-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>Layui-ui 访问 <a target="_blank" rel="noopener" href="http://localhost:8080/docs.html">http://localhost:8080/docs.html</a></li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入swagger-ui-layer包 /docs.html--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.caspar-chen<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-ui-layer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>mg-ui 访问 <a target="_blank" rel="noopener" href="http://localhost:8080/document.html">http://localhost:8080/document.html</a></li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入swagger-ui-layer包 /document.html--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zyplayer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-mg-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="10、关于异步任务"><a href="#10、关于异步任务" class="headerlink" title="10、关于异步任务"></a>10、关于异步任务</h2><p><strong>请浏览</strong> <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/20a4e37314fc">https://www.jianshu.com/p/20a4e37314fc</a></p>
<h4 id="邮件发送"><a href="#邮件发送" class="headerlink" title="邮件发送"></a>邮件发送</h4><p><img src="https://s1.ax1x.com/2022/05/01/OCJm2n.gif" data-original="C:\Users\雷神\AppData\Roaming\Typora\typora-user-images\image-20211109164724576.png" alt="image-20211109164724576"></p>
<p><strong>开启第一个</strong></p>
<p><strong>导入 pom 依赖</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--javax.mail: 配置--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-mail&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p><strong>调用 SpringBoot 的接口即可</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">JavaMailSenderImpl mailSender;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//一个简单的邮件</span></span><br><span class="line">    SimpleMailMessage simpleMailMessage = <span class="keyword">new</span> SimpleMailMessage();</span><br><span class="line">    simpleMailMessage.setSubject(<span class="string">&quot;Cu1 Hello&quot;</span>);</span><br><span class="line">    simpleMailMessage.setText(<span class="string">&quot;芜湖起飞&quot;</span>);</span><br><span class="line">    simpleMailMessage.setTo(<span class="string">&quot;1178079301@qq.com&quot;</span>);</span><br><span class="line">    simpleMailMessage.setFrom(<span class="string">&quot;1178079301@qq.com&quot;</span>);</span><br><span class="line">    mailSender.send(simpleMailMessage);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">contextLoads1</span><span class="params">()</span> <span class="keyword">throws</span> MessagingException </span>&#123;</span><br><span class="line">    <span class="comment">//一个复杂的邮件</span></span><br><span class="line">    MimeMessage message = mailSender.createMimeMessage();</span><br><span class="line">    <span class="comment">//组装 利用 Helper 去组装 message 是否支持多文本上传 第二个参数</span></span><br><span class="line">    MimeMessageHelper mimeMessageHelper = <span class="keyword">new</span> MimeMessageHelper(message, <span class="keyword">true</span>, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    mimeMessageHelper.setSubject(<span class="string">&quot;Cu1 hello - plus&quot;</span>);</span><br><span class="line">    <span class="comment">//第二参数为是否将消息解析为 html</span></span><br><span class="line">    mimeMessageHelper.setText(<span class="string">&quot;&lt;p style=&#x27;color: red&#x27;&gt;芜湖起飞&lt;/p&gt;&quot;</span>, <span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">//添加附件</span></span><br><span class="line">    <span class="comment">//mimeMessageHelper.addAttachment(&quot;1.jpg&quot;, new File());</span></span><br><span class="line">    mimeMessageHelper.setTo(<span class="string">&quot;1178079301@qq.com&quot;</span>);</span><br><span class="line">    mimeMessageHelper.setFrom(<span class="string">&quot;1178079301@qq.com&quot;</span>);</span><br><span class="line">    mailSender.send(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">TaskScheduler 任务调度者</span><br><span class="line">TaskExecutor 任务执行者</span><br><span class="line">//开启定时功能的注解</span><br><span class="line">@EnableScheduling</span><br><span class="line">@Scheduled</span><br></pre></td></tr></table></figure>

<p><strong>使用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduledService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Cron 表达式</span></span><br><span class="line">    <span class="comment">// 秒 分 时 日 月 周几 (表示 22H 13Min 0S 执行)</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 13 22 * * ?&quot;)</span></span><br><span class="line">    <span class="comment">//在特定的时间执行这个方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello 你被执行了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="11、SpringBoot-整合-Redis"><a href="#11、SpringBoot-整合-Redis" class="headerlink" title="11、SpringBoot 整合 Redis"></a>11、SpringBoot 整合 Redis</h2><h4 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(</span></span><br><span class="line"><span class="meta">    name = &#123;&quot;redisTemplate //可以自定义一共 redisTemplate 来替换默认的</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@ConditionalOnSingleCandidate(RedisConnectionFactory.class)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> </span>&#123;</span><br><span class="line"> 	<span class="comment">//默认的 RedisTemplate 没有过多设置 redis 对象都需要序列化</span></span><br><span class="line">    <span class="comment">//两个泛型都是 Object Object 的类型 在后面使用中通常需要强制转换为 &lt;String, Object&gt;</span></span><br><span class="line">    RedisTemplate&lt;Object, Object&gt; template = <span class="keyword">new</span> RedisTemplate();</span><br><span class="line">    template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">    <span class="keyword">return</span> template;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span> <span class="comment">//由于 String 是 redis 中最常用的类型 所以说单独提出来一个 Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnSingleCandidate(RedisConnectionFactory.class)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> StringRedisTemplate <span class="title">stringRedisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> </span>&#123;</span><br><span class="line">    StringRedisTemplate template = <span class="keyword">new</span> StringRedisTemplate();</span><br><span class="line">    template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">    <span class="keyword">return</span> template;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="整合测试-1"><a href="#整合测试-1" class="headerlink" title="整合测试"></a>整合测试</h4><p>1、导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--操作 redis--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、配置连接</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#自动配置类都会绑定一个 properties 配置文件 RedisProperties</span></span><br><span class="line"><span class="comment">#配置 redis</span></span><br><span class="line"><span class="meta">spring.redis.host</span>=<span class="string">127.0.0.1</span></span><br><span class="line"><span class="meta">spring.redis.port</span>=<span class="string">6379</span></span><br></pre></td></tr></table></figure>

<p>3、测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Redis02SpringBootApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * RedisTemplate 操作不同的数据类型 api 和 指令是一样的</span></span><br><span class="line"><span class="comment">        * .opsForValue() 操作字符串 类似 String</span></span><br><span class="line"><span class="comment">        * .opsForList() 操作 List</span></span><br><span class="line"><span class="comment">        * .opsForSet() 操作 Set</span></span><br><span class="line"><span class="comment">        * .opsForHash()</span></span><br><span class="line"><span class="comment">        * .opsForZSet() ...</span></span><br><span class="line"><span class="comment">        * .opsForGeo()</span></span><br><span class="line"><span class="comment">        * 除了基本操作 常用的方法都可以通过 RedisTemplate 操作 比如事务和基本的 CRUD</span></span><br><span class="line"><span class="comment">        * */</span></span><br><span class="line">        <span class="comment">//获取 redis 的连接对象</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            RedisConnection connection = redisTemplate.getConnectionFactory().getConnection();</span></span><br><span class="line"><span class="comment">            connection.flushDb();</span></span><br><span class="line"><span class="comment">            connection.flushAll();</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;myKey&quot;</span>, <span class="string">&quot;Cu1&quot;</span>);</span><br><span class="line">        System.out.println(redisTemplate.opsForValue().get(<span class="string">&quot;mykey&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="RedisTemplate-序列化配置"><a href="#RedisTemplate-序列化配置" class="headerlink" title="RedisTemplate 序列化配置"></a>RedisTemplate 序列化配置</h4><p>默认是使用 <code>JDK</code> 的序列化方式 但是可能需要使用 <code>json</code> 进行序列化 这时就需要自定义配置类</p>
<p>==<strong>关于对象的保存 如果没有序列化则会报错</strong>== 在企业中 所有的 <code>pojo</code> 类都会序列化</p>
<h4 id="自定义-Qualifier"><a href="#自定义-Qualifier" class="headerlink" title="自定义 @Qualifier()"></a>自定义 @Qualifier()</h4><p><strong>编写一个自定义的 RedisTemplate</strong> 如果出现多个 <code>RedisTemplate</code> 可以使用 <code>@Qualifier()</code> 来指定自定义的 <code>@Qualifier()</code></p>
<p>在企业开发中 有 <code>80%</code> 的情况下都不会使用原生的方式去编写代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//固定模板 在企业中直接使用</span></span><br><span class="line">    <span class="comment">//编写自己的 RedisTemplate</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//为方便开发 一般直接使用 &lt;String, Object&gt;</span></span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> RedisTemplate();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="comment">//创建一个序列化方式的对象 序列化配置</span></span><br><span class="line">        <span class="comment">//Json 序列化</span></span><br><span class="line">        Jackson2JsonRedisSerializer&lt;Object&gt; objectJackson2JsonRedisSerializer</span><br><span class="line">                = <span class="keyword">new</span> Jackson2JsonRedisSerializer&lt;Object&gt;(Object.class);</span><br><span class="line"></span><br><span class="line">        ObjectMapper om = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        objectJackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//String 的序列化</span></span><br><span class="line">        StringRedisSerializer stringRedisSerializer = <span class="keyword">new</span> StringRedisSerializer();</span><br><span class="line">        <span class="comment">//key 采用 String 的序列化方式</span></span><br><span class="line">        template.setKeySerializer(stringRedisSerializer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//hash 的 key 也采用 String 的序列化方式</span></span><br><span class="line">        template.setHashKeySerializer(stringRedisSerializer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Value 序列化方式采用 Jackson</span></span><br><span class="line">        template.setValueSerializer(objectJackson2JsonRedisSerializer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//配置具体的序列化方式</span></span><br><span class="line">        template.setKeySerializer(objectJackson2JsonRedisSerializer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//hash 的 value 序列化方式采用 jackson</span></span><br><span class="line">        template.setHashValueSerializer(objectJackson2JsonRedisSerializer);</span><br><span class="line"></span><br><span class="line">        template.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>RedisUtil 类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisUtil</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * @ClassName RedisClient</span></span><br><span class="line"><span class="comment">     * @Desc TODO   设置缓存（没有时间限制）</span></span><br><span class="line"><span class="comment">     * @Date 2021-07-24 16:11</span></span><br><span class="line"><span class="comment">     * @Version 1.0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        redisTemplate.opsForValue().set(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * @ClassName RedisClient</span></span><br><span class="line"><span class="comment">     * @Desc TODO   设置缓存（有时间限制，单位为 秒）</span></span><br><span class="line"><span class="comment">     * @Date 2021-07-24 16:11</span></span><br><span class="line"><span class="comment">     * @Version 1.0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(String key, Object value, <span class="keyword">long</span> timeout)</span> </span>&#123;</span><br><span class="line">        redisTemplate.opsForValue().set(key, value, timeout, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * @ClassName RedisClient</span></span><br><span class="line"><span class="comment">     * @Desc TODO   删除缓存，并返回是否删除成功</span></span><br><span class="line"><span class="comment">     * @Date 2021-07-24 16:11</span></span><br><span class="line"><span class="comment">     * @Version 1.0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">delete</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        redisTemplate.delete(key);</span><br><span class="line">        <span class="comment">// 如果还存在这个 key 就证明删除失败</span></span><br><span class="line">        <span class="keyword">if</span> (redisTemplate.hasKey(key)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="comment">// 不存在就证明删除成功</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * @ClassName RedisClient</span></span><br><span class="line"><span class="comment">     * @Desc TODO   取出缓存</span></span><br><span class="line"><span class="comment">     * @Date 2021-07-24 16:12</span></span><br><span class="line"><span class="comment">     * @Version 1.0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (redisTemplate.hasKey(key)) &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForValue().get(key);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * @ClassName RedisClient</span></span><br><span class="line"><span class="comment">     * @Desc TODO   获取失效时间（-2：失效 / -1：没有时间限制）</span></span><br><span class="line"><span class="comment">     * @Date 2021-07-24 16:15</span></span><br><span class="line"><span class="comment">     * @Version 1.0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getExpire</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 判断是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (redisTemplate.hasKey(key)) &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.getExpire(key);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Long.parseLong(-<span class="number">2</span> + <span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Cu1</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://cu1universe.cn/Java/Spring/SpringBoot/">https://cu1universe.cn/Java/Spring/SpringBoot/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://cu1universe.cn" target="_blank">Cu1universe</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SpringBoot-java/">SpringBoot, java</a></div><div class="post_share"><div class="social-share" data-image="https://s4.ax1x.com/2022/02/14/H6o0n1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/Java/Spring/SpringMVC/"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">SpringMVC</div></div></a></div><div class="next-post pull-right"><a href="/%E7%94%9F%E6%B4%BB/%E6%9C%89%E8%B6%A3%E6%9D%82/2022-05-07-%E5%8F%A0%E5%AD%97/"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">叠字</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="cols"><div class="col"><div class="container"><div class="front avatarPanel"><div class="inner"><div class="player-title">Attributes</div><div class="player-avatar"><img src="https://s4.ax1x.com/2022/02/14/H6o0n1.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div></div></div><div class="back attributesPanel"><div class="inner"><div class="player-lv">LV.3</div><div class="player-name">Cu1</div><div class="attributes-value"><div class="attributes-value-item"><a href="/archives/"><div class="attributes">文章</div><div class="value-bar"><div class="value-bar-fill" style="width:29.00%"><div class="value-bar-fill-in" style="background: rgba(89, 230, 54,0.6)"></div></div></div><span>29/100</span></a></div><div class="attributes-value-item"><a href="/tags/"><div class="attributes">标签</div><div class="value-bar"><div class="value-bar-fill" style="width:20.00%"><div class="value-bar-fill-in" style="background: rgba(224, 20, 20, 0.6)"></div></div></div><span>20/100</span></a></div><div class="attributes-value-item"><a href="/categories/"><div class="attributes">分类</div><div class="value-bar"><div class="value-bar-fill" style="width:16.00%"><div class="value-bar-fill-in" style="background: rgba(30, 97, 226, 0.6)"></div></div></div><span>16/100</span></a></div></div></div></div></div></div><div class="col"><div class="container"><div class="front descriptionPanel"><div class="inner"><div class="player_description"><div style="text-align:center;"><b>庐山烟雨浙江潮，<br>未到千般恨不消。<br>到得还来别无事，<br>庐山烟雨浙江潮。</b></div></div><div class="play-bottom"></div></div></div><div class="back buttonPanel"><div class="inner"><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>点下一行!</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Cu1ii" target="_blank" title="Github"><i class="iconfont icon-github"></i></a><a class="social-icon" href="mailto:cu1universe@gmail.com" target="_blank" title="Email"><i class="iconfont icon-gmail"></i></a><a class="social-icon" href="https://www.zhihu.com/people/hu-luo-bu-xu-62-23" target="_blank" title="知乎"><i class="iconfont icon-zhihu"></i></a></div><div class="play-bottom"></div></div></div></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content"><b>请成为更厉害的大人和更可爱的小孩</b></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot"><span class="toc-number">1.</span> <span class="toc-text">SpringBoot</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%88%9B%E5%BB%BA-SpringBoot-%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.1.</span> <span class="toc-text">1、创建 SpringBoot 项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1%E3%80%81%E5%88%A9%E7%94%A8%E5%AE%98%E7%BD%91%E5%88%9B%E5%BB%BA"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1、利用官网创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2%E3%80%81%E5%88%A9%E7%94%A8-IDEA-%E5%88%9B%E5%BB%BA"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2、利用 IDEA 创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3%E3%80%81%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.3、项目结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81SpringBoot-%E5%8E%9F%E7%90%86%E5%88%9D%E6%AD%A5"><span class="toc-number">1.2.</span> <span class="toc-text">2、SpringBoot 原理初步</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E4%B8%BB%E5%90%AF%E5%8A%A8%E7%B1%BB%E7%9A%84%E8%BF%90%E8%A1%8C"><span class="toc-number">1.3.</span> <span class="toc-text">3、主启动类的运行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1%E3%80%81SpringApplication"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1、SpringApplication</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81SpringBoot-%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.</span> <span class="toc-text">4、SpringBoot 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1、配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2%E3%80%81JSR303%E6%95%B0%E6%8D%AE%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2、JSR303数据校验</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%88%E7%9C%8B%E7%9C%8B%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">先看看如何使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E5%8F%82%E6%95%B0"><span class="toc-number">1.4.2.1.1.</span> <span class="toc-text">常见参数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3%E3%80%81%E5%A4%9A%E7%8E%AF%E5%A2%83%E5%88%87%E6%8D%A2"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3、多环境切换</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-1%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.4.3.0.1.</span> <span class="toc-text">4.3.1、配置文件</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-2%E3%80%81yaml%E7%9A%84%E5%A4%9A%E6%96%87%E6%A1%A3%E5%9D%97"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">4.3.2、yaml的多文档块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-3%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E4%BD%8D%E7%BD%AE"><span class="toc-number">1.4.3.2.</span> <span class="toc-text">4.3.3、配置文件加载位置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-4%E3%80%81%E6%8B%93%E5%B1%95%EF%BC%8C%E8%BF%90%E7%BB%B4%E5%B0%8F%E6%8A%80%E5%B7%A7"><span class="toc-number">1.4.3.3.</span> <span class="toc-text">4.3.4、拓展，运维小技巧</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4%E3%80%81%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E5%8E%9F%E7%90%86%E6%B7%B1%E5%85%A5"><span class="toc-number">1.4.4.</span> <span class="toc-text">4.4、自动装配原理深入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-1%E3%80%81%E5%88%86%E6%9E%90%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-number">1.4.4.1.</span> <span class="toc-text">4.4.1、分析自动配置原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-2%E3%80%81%E7%B2%BE%E9%AB%93"><span class="toc-number">1.4.4.2.</span> <span class="toc-text">4.4.2、精髓</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-3%E3%80%81%E4%BA%86%E8%A7%A3%EF%BC%9A-Conditional"><span class="toc-number">1.4.4.3.</span> <span class="toc-text">4.4.3、了解：@Conditional</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81SpringBoot-Web-%E5%BC%80%E5%8F%91"><span class="toc-number">1.5.</span> <span class="toc-text">5、SpringBoot Web 开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1%E3%80%81%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%AF%BC%E5%85%A5"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1、静态资源导入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-1%E3%80%81%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%98%A0%E5%B0%84%E8%A7%84%E5%88%99"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">5.1.1、静态资源映射规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFwebjars"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">什么是webjars</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-2%E3%80%81%E7%AC%AC%E4%BA%8C%E7%A7%8D%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%98%A0%E5%B0%84%E8%A7%84%E5%88%99"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">5.1.2、第二种静态资源映射规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-3%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%B7%AF%E5%BE%84"><span class="toc-number">1.5.1.4.</span> <span class="toc-text">5.1.3、自定义静态资源路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-4%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-number">1.5.1.5.</span> <span class="toc-text">5.1.4、总结:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2%E3%80%81%E9%A6%96%E9%A1%B5%E5%92%8C%E5%9B%BE%E6%A0%87%E5%AE%9A%E5%88%B6"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.2、首页和图标定制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-1%E3%80%81%E9%A6%96%E9%A1%B5%E5%A4%84%E7%90%86"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">5.2.1、首页处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-2%E3%80%81%E5%9B%BE%E6%A0%87%E5%AE%9A%E5%88%B6"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">5.2.2、图标定制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3%E3%80%81%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E-Thymeleaf"><span class="toc-number">1.5.3.</span> <span class="toc-text">5.3、模板引擎 Thymeleaf</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-1%E3%80%81%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">5.3.1、模板引擎</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-2%E3%80%81%E5%BC%95%E5%85%A5Thymeleaf"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">5.3.2、引入Thymeleaf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-4%E3%80%81Thymeleaf%E5%88%86%E6%9E%90"><span class="toc-number">1.5.3.3.</span> <span class="toc-text">5.3.4、Thymeleaf分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-5%E3%80%81%E6%B5%8B%E8%AF%95"><span class="toc-number">1.5.3.4.</span> <span class="toc-text">5.3.5、测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-6%E3%80%81Thymeleaf-%E8%AF%AD%E6%B3%95"><span class="toc-number">1.5.3.5.</span> <span class="toc-text">5.3.6、Thymeleaf 语法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4%E3%80%81SpringMVC-%E9%85%8D%E7%BD%AE"><span class="toc-number">1.5.4.</span> <span class="toc-text">5.4、SpringMVC 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-4-1%E3%80%81MVC%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.4.0.1.</span> <span class="toc-text">5.4.1、MVC自动配置原理</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%98%E7%BD%91%E9%98%85%E8%AF%BB"><span class="toc-number">1.5.4.0.1.1.</span> <span class="toc-text">官网阅读</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#ContentNegotiatingViewResolver-%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E5%99%A8"><span class="toc-number">1.5.4.0.1.2.</span> <span class="toc-text">ContentNegotiatingViewResolver 内容协商视图解析器</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BD%AC%E6%8D%A2%E5%99%A8%E5%92%8C%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%99%A8"><span class="toc-number">1.5.4.0.1.3.</span> <span class="toc-text">转换器和格式化器</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9SpringBoot%E7%9A%84%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE"><span class="toc-number">1.5.4.0.1.4.</span> <span class="toc-text">修改SpringBoot的默认配置</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E4%BD%BF%E7%94%A8SpringMVC"><span class="toc-number">1.5.4.0.1.5.</span> <span class="toc-text">扩展使用SpringMVC</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%85%A8%E9%9D%A2%E6%8E%A5%E7%AE%A1SpringMVC"><span class="toc-number">1.5.4.0.1.6.</span> <span class="toc-text">全面接管SpringMVC</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.6.</span> <span class="toc-text">6、数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1%E3%80%81SpringData%E7%AE%80%E4%BB%8B"><span class="toc-number">1.6.1.</span> <span class="toc-text">6.1、SpringData简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2%E3%80%81%E6%95%B4%E5%90%88JDBC-%E5%BB%BA%E8%AE%AE%E5%BF%AB%E9%80%9F%E7%9C%8B%E8%BF%87%E5%8D%B3%E5%8F%AF"><span class="toc-number">1.6.2.</span> <span class="toc-text">6.2、整合JDBC (建议快速看过即可)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95%E9%A1%B9%E7%9B%AE%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">创建测试项目测试数据源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JDBCTemplate"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">JDBCTemplate</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3%E3%80%81-%E9%9B%86%E6%88%90Druid"><span class="toc-number">1.6.3.</span> <span class="toc-text">6.3、 集成Druid</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Druid%E7%AE%80%E4%BB%8B"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">Druid简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">配置数据源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5Log4j-%E7%9A%84%E4%BE%9D%E8%B5%96"><span class="toc-number">1.6.3.3.</span> <span class="toc-text">导入Log4j 的依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEDruid%E6%95%B0%E6%8D%AE%E6%BA%90%E7%9B%91%E6%8E%A7"><span class="toc-number">1.6.3.4.</span> <span class="toc-text">配置Druid数据源监控</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-Druid-web-%E7%9B%91%E6%8E%A7-filter-%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">1.6.3.5.</span> <span class="toc-text">配置 Druid web 监控 filter 过滤器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4%E3%80%81%E6%95%B4%E5%90%88-MyBatis"><span class="toc-number">1.6.4.</span> <span class="toc-text">6.4、整合 MyBatis</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B4%E5%90%88%E6%B5%8B%E8%AF%95"><span class="toc-number">1.6.4.1.</span> <span class="toc-text">整合测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E4%BF%A1%E6%81%AF%EF%BC%88%E4%B8%8D%E5%8F%98%EF%BC%89"><span class="toc-number">1.6.4.2.</span> <span class="toc-text">配置数据库连接信息（不变）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB%EF%BC%8C%E5%AF%BC%E5%85%A5-Lombok"><span class="toc-number">1.6.4.3.</span> <span class="toc-text">创建实体类，导入 Lombok</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAmapper%E7%9B%AE%E5%BD%95%E4%BB%A5%E5%8F%8A%E5%AF%B9%E5%BA%94%E7%9A%84-Mapper-%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.6.4.4.</span> <span class="toc-text">创建mapper目录以及对应的 Mapper 接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E5%BA%94%E7%9A%84Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span class="toc-number">1.6.4.5.</span> <span class="toc-text">对应的Mapper映射文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99-Controller-%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95%EF%BC%81"><span class="toc-number">1.6.4.6.</span> <span class="toc-text">编写 Controller 进行测试！</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81SpringSecurity"><span class="toc-number">1.7.</span> <span class="toc-text">7、SpringSecurity</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%AE%80%E4%BB%8B"><span class="toc-number">1.7.1.</span> <span class="toc-text">安全简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5-SpringSecurity"><span class="toc-number">1.7.2.</span> <span class="toc-text">导入 SpringSecurity</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A4%E8%AF%86SpringSecurity"><span class="toc-number">1.7.3.</span> <span class="toc-text">认识SpringSecurity</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99-Spring-Security-%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-number">1.7.4.</span> <span class="toc-text">编写 Spring Security 配置类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81Shrio"><span class="toc-number">1.8.</span> <span class="toc-text">8、Shrio</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E5%89%8D%E4%BA%86%E8%A7%A3%E4%B8%80%E4%BA%9B%E4%BB%80%E4%B9%88"><span class="toc-number">1.8.1.</span> <span class="toc-text">提前了解一些什么</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3-Shiro-%E7%9A%84%E4%B8%89%E5%A4%A7%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">了解 Shiro 的三大对象</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringBoot-%E6%95%B4%E5%90%88-Shrio"><span class="toc-number">1.8.2.</span> <span class="toc-text">SpringBoot 整合 Shrio</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5-Shrio-%E7%9A%84%E5%8C%85"><span class="toc-number">1.8.2.1.</span> <span class="toc-text">导入 Shrio 的包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-Shrio-%E7%9A%84%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-number">1.8.2.2.</span> <span class="toc-text">配置 Shrio 的配置类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Shrio-%E6%95%B4%E5%90%88-MyBatis"><span class="toc-number">1.8.3.</span> <span class="toc-text">Shrio 整合 MyBatis</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5-MySQL-Druid-MyBatis-%E7%9A%84-pom-%E4%BE%9D%E8%B5%96"><span class="toc-number">1.8.3.1.</span> <span class="toc-text">导入 MySQL  Druid, MyBatis 的 pom 依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-MyBatis-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.8.3.2.</span> <span class="toc-text">配置 MyBatis 配置文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Shrio-%E6%95%B4%E5%90%88-thymeleaf"><span class="toc-number">1.8.4.</span> <span class="toc-text">Shrio 整合 thymeleaf</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5-pom-%E4%BE%9D%E8%B5%96"><span class="toc-number">1.8.4.1.</span> <span class="toc-text">导入 pom 依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8-html-%E6%96%87%E4%BB%B6%E4%B8%8A%E5%8A%A0%E5%85%A5%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="toc-number">1.8.4.2.</span> <span class="toc-text">在 html 文件上加入命名空间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Shrio-%E4%B8%8E-thymeleaf-%E5%9C%A8-html-%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.8.4.3.</span> <span class="toc-text">Shrio 与 thymeleaf 在 html 中的使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Shrio-%E5%9C%A8-SpringBoot-%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.8.5.</span> <span class="toc-text">Shrio 在 SpringBoot 中的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%EF%BC%9A"><span class="toc-number">1.8.6.</span> <span class="toc-text">扩展：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E3%80%81Swagger"><span class="toc-number">1.9.</span> <span class="toc-text">9、Swagger</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Swagger%E7%AE%80%E4%BB%8B"><span class="toc-number">1.9.0.1.</span> <span class="toc-text">Swagger简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Swagger%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">1.9.0.2.</span> <span class="toc-text">Swagger是什么？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SpringBoot-%E6%95%B4%E5%90%88-Swagger"><span class="toc-number">1.9.0.3.</span> <span class="toc-text">SpringBoot 整合 Swagger</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5-pom-%E4%BE%9D%E8%B5%96-1"><span class="toc-number">1.9.0.3.1.</span> <span class="toc-text">导入 pom 依赖</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99-Swagger-%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-number">1.9.0.4.</span> <span class="toc-text">编写 Swagger 配置类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%B1%BB"><span class="toc-number">1.9.0.5.</span> <span class="toc-text">测试类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.9.0.6.</span> <span class="toc-text">常用注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%8C%E6%9C%9B-Swagger-%E5%9C%A8%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%AD%E4%BD%BF%E7%94%A8-%E5%9C%A8%E5%8F%91%E5%B8%83%E5%90%8E%E4%B8%8D%E8%83%BD%E4%BD%BF%E7%94%A8"><span class="toc-number">1.9.0.7.</span> <span class="toc-text">希望 Swagger 在生产环境中使用 在发布后不能使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-API-%E6%96%87%E6%A1%A3%E5%88%86%E7%BB%84"><span class="toc-number">1.9.0.8.</span> <span class="toc-text">配置 API 文档分组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.9.0.9.</span> <span class="toc-text">总结:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E7%82%B9-%E5%9C%A8%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83%E6%97%B6-%E5%85%B3%E9%97%AD-Swagger-%E5%87%BA%E4%BA%8E%E5%AE%89%E5%85%A8%E8%80%83%E8%99%91-%E8%80%8C%E4%B8%94%E8%8A%82%E7%9C%81%E5%86%85%E5%AD%98%E7%A9%BA%E9%97%B4"><span class="toc-number">1.9.0.10.</span> <span class="toc-text">注意点 : 在正式发布时 关闭 Swagger 出于安全考虑 而且节省内存空间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%EF%BC%9A%E7%9A%AE%E8%82%A4%EF%BC%81%EF%BC%81"><span class="toc-number">1.9.0.11.</span> <span class="toc-text">扩展：皮肤！！</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E3%80%81%E5%85%B3%E4%BA%8E%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.10.</span> <span class="toc-text">10、关于异步任务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81"><span class="toc-number">1.10.0.1.</span> <span class="toc-text">邮件发送</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.10.0.2.</span> <span class="toc-text">定时任务</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11%E3%80%81SpringBoot-%E6%95%B4%E5%90%88-Redis"><span class="toc-number">1.11.</span> <span class="toc-text">11、SpringBoot 整合 Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">1.11.0.1.</span> <span class="toc-text">源码分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B4%E5%90%88%E6%B5%8B%E8%AF%95-1"><span class="toc-number">1.11.0.2.</span> <span class="toc-text">整合测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RedisTemplate-%E5%BA%8F%E5%88%97%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="toc-number">1.11.0.3.</span> <span class="toc-text">RedisTemplate 序列化配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-Qualifier"><span class="toc-number">1.11.0.4.</span> <span class="toc-text">自定义 @Qualifier()</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/Java/HTML/" title="HTML">HTML</a><time datetime="2022-05-16T16:00:00.000Z" title="发表于 2022-05-17 00:00:00">2022-05-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/Java/Spring/Spring/" title="Spring">Spring</a><time datetime="2022-05-16T16:00:00.000Z" title="发表于 2022-05-17 00:00:00">2022-05-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/Java/Spring/SpringMVC/" title="SpringMVC">SpringMVC</a><time datetime="2022-05-16T16:00:00.000Z" title="发表于 2022-05-17 00:00:00">2022-05-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/Java/Spring/SpringBoot/" title="SpringBoot">SpringBoot</a><time datetime="2022-05-16T16:00:00.000Z" title="发表于 2022-05-17 00:00:00">2022-05-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/%E7%94%9F%E6%B4%BB/%E6%9C%89%E8%B6%A3%E6%9D%82/2022-05-07-%E5%8F%A0%E5%AD%97/" title="叠字">叠字</a><time datetime="2022-05-06T16:00:00.000Z" title="发表于 2022-05-07 00:00:00">2022-05-07</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Cu1</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twiko-32cx40g3a-cu1universe-gmailcom.vercel.app/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.vemoji)'))
      }
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'https://twiko-32cx40g3a-cu1universe-gmailcom.vercel.app/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      document.getElementById('twikoo-count').innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script async src="/js/diytitle.js"></script><script async src="//at.alicdn.com/t/font_2264842_3izu8i5eoc2.js"></script><div class="aplayer no-destroy" data-id="7325805268" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="false" muted></div><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="I,LOVE,YOU" data-fontsize="15px" data-random="false" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><div id="ghbdages" style="overflow:hidden;max-height:90px;height:auto;text-align:center;margin-top:10px"><div class="swiper-wrapper"><div class="swiper-slide"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="博客框架为Hexo_v5.4.0"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="主题版本Butterfly_v3.8.2"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://www.jsdelivr.com/" style="margin-inline:5px" title="本站使用JsDelivr为静态资源提供CDN加速"><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&amp;logo=jsDelivr" alt=""/></a></div><div class="swiper-slide"><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="本站项目由Github托管"><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></div></div></div><style>a.github-badge:hover:before {display:none}</style>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="https://cdn.jsdelivr.net/gh/Cu1ii/BlogDebris@main/CDN/js/runtime.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-footer-beautify/lib/swiperbdage_init.min.js"></script><script data-pjax>
  function butterfly_clock_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://npm.elemecdn.com/hexo-butterfly-clock/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_injector_config();
  }
  </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax src="https://npm.elemecdn.com/hexo-butterfly-clock/lib/clock.min.js"></script><!-- hexo injector body_end end --><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},t.src!==i&&(n.src=i)}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body></html>